<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ —Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f1f5f9;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-secondary {
            background-color: #64748b;
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .tab-container {
            display: flex;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
            text-align: center;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .card-header {
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            table-layout: fixed;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            word-wrap: break-word;
        }
        
        th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        .status-paid {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .status-unpaid {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .status-partial {
            color: var(--warning-color);
            font-weight: 600;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge-primary {
            background-color: #dbeafe;
            color: var(--primary-color);
        }
        
        .badge-success {
            background-color: #d1fae5;
            color: var(--success-color);
        }
        
        .badge-warning {
            background-color: #fef3c7;
            color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: #fee2e2;
            color: var(--danger-color);
        }
        
        .badge-info {
            background-color: #e0f2fe;
            color: #0369a1;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .month-display {
            font-weight: 600;
            font-size: 1.2rem;
            min-width: 160px;
            text-align: center;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-warning {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .alert-danger {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .alert-info {
            background-color: #e0f2fe;
            color: #0369a1;
            border: 1px solid #bae6fd;
        }
        
        .hidden {
            display: none !important;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }
        
        .methodology {
            background-color: #f8fafc;
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 5px 5px 0;
        }
        
        .methodology h4 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .search-box {
            margin-bottom: 1rem;
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 0.875rem;
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
        }
        
        .meter-type-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .meter-type-individual {
            background-color: #d1fae5;
            color: var(--success-color);
        }
        
        .meter-type-group {
            background-color: #dbeafe;
            color: var(--primary-color);
        }
        
        .day-type-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .day-type-normal {
            background-color: #d1fae5;
            color: var(--success-color);
        }
        
        .day-type-extended {
            background-color: #fef3c7;
            color: var(--warning-color);
        }
        
        .day-type-24h {
            background-color: #fee2e2;
            color: var(--danger-color);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.positive {
            color: var(--success-color);
        }
        
        .stat-change.negative {
            color: var(--danger-color);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        
        .period-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .period-btn {
            padding: 0.5rem 1rem;
            background-color: #f1f5f9;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .period-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #f8fafc;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .resource-name {
            font-weight: 500;
        }
        
        .resource-amount {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .dashboard-section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--dark-color);
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .compact-table {
            font-size: 0.9rem;
        }
        
        .compact-table th,
        .compact-table td {
            padding: 0.5rem;
        }
        
        .tenant-name {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .github-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 1rem;
        }
        
        .github-status.cloud {
            background-color: #d1fae5;
            color: var(--success-color);
        }
        
        .github-status.local {
            background-color: #fef3c7;
            color: var(--warning-color);
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-container {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 2rem;
            }
            
            .month-selector {
                justify-content: center;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            .chart-container {
                height: 250px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
            
            .tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ —Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h1>
                    <p style="opacity: 0.9; font-size: 0.9rem;">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å—á–µ—Ç—á–∏–∫–∞–º–∏ –∏ –æ–±–ª–∞—á–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º</p>
                </div>
                <div>
                    <button class="btn btn-primary" id="syncButton" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –æ–±–ª–∞–∫–æ–º">
                        <span>‚òÅÔ∏è</span> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-danger" id="clearDataBtn" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ">
                        <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
            <div class="month-selector">
                <button class="btn btn-primary" id="prevMonthBtn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü</button>
                <div class="month-display" id="currentMonthDisplay">–Ø–Ω–≤–∞—Ä—å 2024</div>
                <button class="btn btn-primary" id="nextMonthBtn">–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü ‚Üí</button>
                <button class="btn btn-success" id="generateInvoicesBtn">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—á–µ—Ç–∞</button>
                <div id="storageStatus"></div>
            </div>
        </header>
        
        <div class="tab-container">
            <button class="tab-btn active" data-tab="dashboard">–î–∞—à–±–æ—Ä–¥</button>
            <button class="tab-btn" data-tab="tenants">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã</button>
            <button class="tab-btn" data-tab="meters">–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</button>
            <button class="tab-btn" data-tab="bills">–°—á–µ—Ç–∞ –†–°–û</button>
            <button class="tab-btn" data-tab="invoices">–°—á–µ—Ç–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º</button>
            <button class="tab-btn" data-tab="activities">–í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            <button class="tab-btn" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab-btn" data-tab="methodology">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è</button>
            <button class="tab-btn" data-tab="github">GitHub</button>
        </div>
        
        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div class="tab-content active" id="dashboard">
            <div class="dashboard-section">
                <h2 class="section-title">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã</div>
                        <div class="stat-value" id="tenantsCount">0</div>
                        <div class="stat-change" id="tenantsChange">+0 –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–°—á–µ—Ç–∞ –†–°–û</div>
                        <div class="stat-value" id="billsCount">0</div>
                        <div class="stat-change" id="billsChange">+0 –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–°—á–µ—Ç–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º</div>
                        <div class="stat-value" id="invoicesCount">0</div>
                        <div class="stat-change" id="invoicesChange">+0 –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –æ–ø–ª–∞—Ç—ã</div>
                        <div class="stat-value" id="paymentRate">0%</div>
                        <div class="stat-change" id="paymentChange">+0% –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞ —Å—á–µ—Ç–æ–≤ –†–°–û</div>
                        <div class="stat-value" id="totalBillsAmount">0 ‚ÇΩ</div>
                        <div class="stat-change" id="billsAmountChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–í—ã—Å—Ç–∞–≤–ª–µ–Ω–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º</div>
                        <div class="stat-value" id="totalInvoicesAmount">0 ‚ÇΩ</div>
                        <div class="stat-change" id="invoicesAmountChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–°–æ–±—Ä–∞–Ω–æ –æ–ø–ª–∞—Ç</div>
                        <div class="stat-value" id="totalPaidAmount">0 ‚ÇΩ</div>
                        <div class="stat-change" id="paidAmountChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</div>
                        <div class="stat-value" id="totalDebtAmount">0 ‚ÇΩ</div>
                        <div class="stat-change" id="debtAmountChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üìà –î–∏–Ω–∞–º–∏–∫–∞ —Å—á–µ—Ç–æ–≤ –†–°–û</h2>
                <div class="period-selector" id="billsPeriodSelector">
                    <button class="period-btn active" data-period="3">3 –º–µ—Å—è—Ü–∞</button>
                    <button class="period-btn" data-period="6">6 –º–µ—Å—è—Ü–µ–≤</button>
                    <button class="period-btn" data-period="12">12 –º–µ—Å—è—Ü–µ–≤</button>
                    <button class="period-btn" data-period="all">–í—Å—ë –≤—Ä–µ–º—è</button>
                </div>
                <div class="chart-container">
                    <canvas id="billsChart"></canvas>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üìä –°—á–µ—Ç–∞ –ø–æ —Ç–∏–ø–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤</h2>
                <div class="resource-grid" id="resourceDistribution">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üìä –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</h2>
                <div class="chart-container">
                    <canvas id="paymentChart"></canvas>
                </div>
                <div id="paymentStatusDetails" style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>–û–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é:</span>
                        <span id="fullyPaidCount">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>–ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ:</span>
                        <span id="partialPaidCount">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ:</span>
                        <span id="unpaidCount">0</span>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üè¢ –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã</h2>
                <div id="activeTenants">
                    <table class="compact-table">
                        <thead>
                            <tr>
                                <th style="width: 30%">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä</th>
                                <th style="width: 25%">–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</th>
                                <th style="width: 15%">–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ.</th>
                                <th style="width: 15%">–°—É–º–º–∞ —Å—á–µ—Ç–∞</th>
                                <th style="width: 15%">–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã</th>
                            </tr>
                        </thead>
                        <tbody id="tenantsStatusBody">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-title">üìÖ –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ <span id="dashboardMonthDisplay">–Ø–Ω–≤–∞—Ä—å 2024</span></h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div class="card">
                        <div class="card-header">–°—á–µ—Ç–∞ –†–°–û –∑–∞ –º–µ—Å—è—Ü</div>
                        <div id="monthlyBillsList">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">–¢–æ–ø-5 –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –ø–æ —Å—É–º–º–µ —Å—á–µ—Ç–æ–≤</div>
                        <div id="topTenantsList">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã -->
        <div class="tab-content" id="tenants">
            <div class="card-header">
                <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º–∏</span>
                <button class="btn btn-primary" id="addTenantBtn">+ –î–æ–±–∞–≤–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</button>
            </div>
            <div class="search-box">
                <input type="text" id="tenantSearch" placeholder="–ü–æ–∏—Å–∫ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞...">
            </div>
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%">ID</th>
                        <th style="width: 25%">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                        <th style="width: 10%">–ü–ª–æ—â–∞–¥—å (–º¬≤)</th>
                        <th style="width: 20%">–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</th>
                        <th style="width: 10%">–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ.</th>
                        <th style="width: 20%">–°—á–µ—Ç—á–∏–∫–∏</th>
                        <th style="width: 10%">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="tenantsTableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>
        </div>
        
        <!-- –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ -->
        <div class="tab-content" id="meters">
            <div class="card-header">
                <span>–í–≤–æ–¥ –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤</span>
                <div>
                    <span style="margin-right: 1rem;">–ü–µ—Ä–∏–æ–¥: <strong id="meterPeriodDisplay">–Ø–Ω–≤–∞—Ä—å 2024</strong></span>
                    <button class="btn btn-success" id="saveMetersBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</button>
                </div>
            </div>
            
            <div class="methodology">
                <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç—á–∏–∫–∞—Ö:</h4>
                <p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏</strong> ‚Äì —É—á–∏—Ç—ã–≤–∞—é—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞.</p>
                <p><strong>–ì—Ä—É–ø–ø–æ–≤—ã–µ —Å—á–µ—Ç—á–∏–∫–∏</strong> ‚Äì —É—á–∏—Ç—ã–≤–∞—é—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤.</p>
            </div>
            
            <div id="metersInputSection">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </div>
        </div>
        
        <!-- –°—á–µ—Ç–∞ –†–°–û -->
        <div class="tab-content" id="bills">
            <div class="card-header">
                <span>–°—á–µ—Ç–∞ –æ—Ç —Ä–µ—Å—É—Ä—Å–æ—Å–Ω–∞–±–∂–∞—é—â–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</span>
                <div>
                    <button class="btn btn-primary" id="addGeneralBillBtn">+ –û–±—â–∏–π —Å—á–µ—Ç</button>
                    <button class="btn btn-success" id="addIndividualBillBtn">+ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å—á–µ—Ç</button>
                </div>
            </div>
            
            <div class="methodology">
                <h4>–í–∏–¥—ã —Å—á–µ—Ç–æ–≤:</h4>
                <p><strong>–û–±—â–∏–µ —Å—á–µ—Ç–∞</strong> ‚Äì —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º–∏ —Å —É—á–µ—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è, –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ).</p>
                <p><strong>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç–∞</strong> ‚Äì –≤—ã—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É (–≤—ã–≤–æ–∑ –¢–ö–û, –≤–æ–¥–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞).</p>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th style="width: 10%">–î–∞—Ç–∞</th>
                        <th style="width: 20%">–¢–∏–ø —Ä–µ—Å—É—Ä—Å–∞</th>
                        <th style="width: 15%">–°—É–º–º–∞ (—Ä—É–±.)</th>
                        <th style="width: 25%">–û–±—ä–µ–º/–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th style="width: 15%">–¢–∏–ø —Å—á–µ—Ç–∞</th>
                        <th style="width: 15%">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="rsoBillsTableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>
        </div>
        
        <!-- –°—á–µ—Ç–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º -->
        <div class="tab-content" id="invoices">
            <div class="card-header">
                <span>–°—á–µ—Ç–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º</span>
                <div>
                    <button class="btn btn-warning" id="recalculateBtn">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞</button>
                </div>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä</th>
                        <th style="width: 15%">–ü–µ—Ä–∏–æ–¥</th>
                        <th style="width: 15%">–°—É–º–º–∞ (—Ä—É–±.)</th>
                        <th style="width: 15%">–û–ø–ª–∞—á–µ–Ω–æ (—Ä—É–±.)</th>
                        <th style="width: 15%">–°—Ç–∞—Ç—É—Å</th>
                        <th style="width: 15%">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="invoicesTableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>
        </div>
        
        <!-- –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
        <div class="tab-content" id="activities">
            <div class="card-header">
                <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞–º–∏ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</span>
                <button class="btn btn-primary" id="addActivityBtn">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
            </div>
            
            <div class="methodology">
                <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
                <p><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</strong> ‚Äì –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö –∑–∞—Ç—Ä–∞—Ç (–≥–∞–∑, –ú–û–ü, —á–∞—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏).</p>
                <p><strong>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</strong> ‚Äì –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏:</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å</strong> ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 8-—á–∞—Å–æ–≤–æ–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å (–∫–æ—ç—Ñ—Ñ. 1.0)</li>
                    <li><strong>–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å</strong> ‚Äì 12-16 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã (–∫–æ—ç—Ñ—Ñ. 1.3)</li>
                    <li><strong>–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ</strong> ‚Äì 24/7 —Ä–∞–±–æ—Ç–∞ (–∫–æ—ç—Ñ—Ñ. 1.8)</li>
                </ul>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%">ID</th>
                        <th style="width: 20%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th style="width: 10%">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</th>
                        <th style="width: 15%">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</th>
                        <th style="width: 10%">–ö–æ—ç—Ñ—Ñ. —Ä–µ–∂–∏–º–∞</th>
                        <th style="width: 10%">–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ.</th>
                        <th style="width: 20%">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                        <th style="width: 10%">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="activitiesTableBody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content" id="settings">
            <div class="card-header">
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã</span>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã</div>
                    <div id="dayTypeCoefficients">
                        <div class="form-group">
                            <label for="coeffNormalDay">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å (8 —á–∞—Å–æ–≤)</label>
                            <input type="number" id="coeffNormalDay" step="0.1" value="1.0" min="0.5" max="2.0">
                        </div>
                        <div class="form-group">
                            <label for="coeffExtendedDay">–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å (12-16 —á–∞—Å–æ–≤)</label>
                            <input type="number" id="coeffExtendedDay" step="0.1" value="1.3" min="0.5" max="2.0">
                        </div>
                        <div class="form-group">
                            <label for="coeff24hDay">–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (24 —á–∞—Å–∞)</label>
                            <input type="number" id="coeff24hDay" step="0.1" value="1.8" min="0.5" max="2.0">
                        </div>
                        <button class="btn btn-primary" id="saveDayTypeCoefficientsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–µ–∂–∏–º–æ–≤</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ú–û–ü</div>
                    <div id="mopSettings">
                        <div class="form-group">
                            <label for="mopArea">–ü–ª–æ—â–∞–¥—å –ú–û–ü (–º¬≤)</label>
                            <input type="number" id="mopArea" value="150">
                        </div>
                        <div class="form-group">
                            <label for="mopCost">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ú–û–ü (—Ä—É–±./–º¬≤)</label>
                            <input type="number" id="mopCost" value="100" step="1">
                        </div>
                        <div class="form-group">
                            <label for="electricityLossPercent">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Ç–µ—Ä—å –≤ —Å–µ—Ç—è—Ö (%)</label>
                            <input type="number" id="electricityLossPercent" value="5" step="0.1" min="0" max="20">
                        </div>
                        <button class="btn btn-primary" id="saveMopSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ú–û–ü</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</div>
                    <div id="dataManagement">
                        <div class="form-group">
                            <label>–í–µ—Ä—Å–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã:</label>
                            <p id="appVersion">2.2.0 (—Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)</p>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" id="exportDataBtn">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                            <button class="btn btn-warning" id="importDataBtn">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                            <button class="btn btn-danger" id="deleteAllDataBtn">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è -->
        <div class="tab-content" id="methodology">
            <div class="card-header">
                <span>–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</span>
            </div>
            
            <div class="methodology">
                <h4>1. –†–∞—Å—á–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ —Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
                <p><strong>–û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø:</strong> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–æ —Å—á–µ—Ç—á–∏–∫–∞–º, –Ω–æ –∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞.</p>
                
                <p><strong>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ √ó –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã</strong></p>
                
                <p><strong>–ü—Ä–∏–º–µ—Ä:</strong> –ê–≤—Ç–æ–º–æ–π–∫–∞ (–∫–æ—ç—Ñ—Ñ. 1.3) —Å –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω—ã–º —Ä–µ–∂–∏–º–æ–º (–∫–æ—ç—Ñ—Ñ. 1.8) –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 2.34, —á—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç –µ—ë –¥–æ–ª—é –≤ –æ–±—â–∏—Ö —Ä–∞—Å—Ö–æ–¥–∞—Ö.</p>
            </div>
            
            <div class="methodology">
                <h4>2. –†–∞—Å—á–µ—Ç –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è (–æ—Ç–æ–ø–ª–µ–Ω–∏–µ –∏ –ì–í–°)</h4>
                <p><strong>–û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø:</strong> –û–±—â–∏–π —Å—á–µ—Ç –Ω–∞ –∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º–∏ —Å —É—á–µ—Ç–æ–º –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞.</p>
                
                <p><strong>–®–∞–≥ 1:</strong> –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—É—é –ø–ª–æ—â–∞–¥—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞:</p>
                <p style="padding-left: 20px;">–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å = –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å √ó –ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</p>
                
                <p><strong>–®–∞–≥ 2:</strong> –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É —Å—á–µ—Ç–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏.</p>
            </div>
            
            <div class="methodology">
                <h4>3. –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
                <table style="width: 100%; margin-top: 10px;">
                    <thead>
                        <tr>
                            <th>–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</th>
                            <th>–ö–æ—ç—Ñ—Ñ. –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</th>
                            <th>–¢–∏–ø–∏—á–Ω—ã–π —Ä–µ–∂–∏–º</th>
                            <th>–ö–æ—ç—Ñ—Ñ. —Ä–µ–∂–∏–º–∞</th>
                            <th>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>–†–æ–∑–Ω–∏—á–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</td>
                            <td>1.0</td>
                            <td>–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å</td>
                            <td>1.0</td>
                            <td>1.0</td>
                        </tr>
                        <tr>
                            <td>–†–µ—Å—Ç–æ—Ä–∞–Ω</td>
                            <td>1.3</td>
                            <td>–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å</td>
                            <td>1.3</td>
                            <td>1.69</td>
                        </tr>
                        <tr>
                            <td>–ê–≤—Ç–æ–º–æ–π–∫–∞</td>
                            <td>1.2</td>
                            <td>–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ</td>
                            <td>1.8</td>
                            <td>2.16</td>
                        </tr>
                        <tr>
                            <td>–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å</td>
                            <td>1.2</td>
                            <td>–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å</td>
                            <td>1.3</td>
                            <td>1.56</td>
                        </tr>
                        <tr>
                            <td>–°–∫–ª–∞–¥</td>
                            <td>0.8</td>
                            <td>–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å</td>
                            <td>1.0</td>
                            <td>0.8</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ GitHub -->
        <div class="tab-content" id="github">
            <div class="card-header">
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ GitHub</span>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub</div>
                    <div id="githubConfig">
                        <div class="form-group">
                            <label for="githubToken">Personal Access Token *</label>
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                            <small style="color: #64748b;">–¢–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ "repo"</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="githubRepo">–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π *</label>
                            <input type="text" id="githubRepo" placeholder="username/repo-name">
                            <small style="color: #64748b;">–ù–∞–ø—Ä–∏–º–µ—Ä: –≤–∞—à-–ª–æ–≥–∏–Ω/utility-app</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="githubBranch">–í–µ—Ç–∫–∞</label>
                            <input type="text" id="githubBranch" value="main" placeholder="main">
                        </div>
                        
                        <div class="form-group">
                            <label for="githubDataFile">–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö</label>
                            <input type="text" id="githubDataFile" value="data.json">
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-success" id="saveGitHubConfigBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                            <button class="btn btn-primary" id="testGitHubConnectionBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">–°—Ç–∞—Ç—É—Å –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</div>
                    <div id="githubStatusInfo">
                        <div class="form-group">
                            <label>–°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</label>
                            <div id="connectionStatus" style="padding: 10px; border-radius: 5px; margin-top: 5px;">
                                <span id="statusText">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                                <span id="statusIcon">‚ùå</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</label>
                            <p id="lastSyncTime">–ù–∏–∫–æ–≥–¥–∞</p>
                        </div>
                        
                        <div class="form-group">
                            <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                            <p id="userId">–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</p>
                        </div>
                        
                        <div class="form-group">
                            <label>–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:</label>
                            <p id="dataSize">0 KB</p>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="forceSyncBtn">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                            <button class="btn btn-warning" id="showInstructionsBtn">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ GitHub Pages</div>
                    <div id="githubPagesInfo">
                        <div class="methodology">
                            <h4>–í–∞—à —Å–∞–π—Ç –Ω–∞ GitHub Pages:</h4>
                            <p id="githubPagesUrl" style="word-break: break-all; background: #f8fafc; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                https://[–≤–∞—à-–ª–æ–≥–∏–Ω].github.io/[—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π]/
                            </p>
                            
                            <h4>–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Pages:</h4>
                            <ol style="margin-left: 20px; margin-top: 10px;">
                                <li>–ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</li>
                                <li>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "Pages"</li>
                                <li>–í —Ä–∞–∑–¥–µ–ª–µ "Source" –≤—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É "main" –∏ –ø–∞–ø–∫—É "/ (root)"</li>
                                <li>–ù–∞–∂–º–∏—Ç–µ "Save"</li>
                            </ol>
                            
                            <h4>–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω:</h4>
                            <ol style="margin-left: 20px; margin-top: 10px;">
                                <li>–ó–∞–π–¥–∏—Ç–µ –≤ Settings ‚Üí Developer settings ‚Üí Personal access tokens</li>
                                <li>–ù–∞–∂–º–∏—Ç–µ "Generate new token (classic)"</li>
                                <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ "repo" (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º)</li>
                                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div class="modal-overlay" id="tenantModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTenantTitle">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</h3>
                    <button class="close-modal" onclick="closeModal('tenantModal')">√ó</button>
                </div>
                
                <div class="form-group">
                    <label for="tenantName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ *</label>
                    <input type="text" id="tenantName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û '–†–æ–º–∞—à–∫–∞'">
                </div>
                
                <div class="form-group">
                    <label for="tenantArea">–ü–ª–æ—â–∞–¥—å (–º¬≤) *</label>
                    <input type="number" id="tenantArea" required min="1" step="0.1" placeholder="50">
                </div>
                
                <div class="form-group">
                    <label for="tenantActivityType">–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ *</label>
                    <select id="tenantActivityType" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</option>
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–°—á–µ—Ç—á–∏–∫–∏:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
                        <div>
                            <label for="electricityMeterId">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</label>
                            <input type="text" id="electricityMeterId" placeholder="EL-001">
                        </div>
                        <div>
                            <label for="waterMeterId">–í–æ–¥–∞</label>
                            <input type="text" id="waterMeterId" placeholder="W-001">
                        </div>
                        <div style="grid-column: span 2;">
                            <label for="groupMeterId">–ì—Ä—É–ø–ø–æ–≤–æ–π —Å—á–µ—Ç—á–∏–∫ (–µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ)</label>
                            <input type="text" id="groupMeterId" placeholder="GRP-001">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="tenantPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="text" id="tenantPhone" placeholder="+7 (XXX) XXX-XX-XX">
                </div>
                
                <div class="form-group">
                    <label for="tenantEmail">Email</label>
                    <input type="email" id="tenantEmail" placeholder="example@mail.ru">
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal('tenantModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-success" id="saveTenantBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <div class="modal-overlay" id="billModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalBillTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç</h3>
                    <button class="close-modal" onclick="closeModal('billModal')">√ó</button>
                </div>
                
                <div class="form-group">
                    <label for="billResourceType">–¢–∏–ø —Ä–µ—Å—É—Ä—Å–∞ *</label>
                    <select id="billResourceType" required>
                        <option value="electricity">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</option>
                        <option value="gas">–ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</option>
                        <option value="water">–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</option>
                        <option value="trash">–í—ã–≤–æ–∑ –¢–ö–û</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="billAmount">–°—É–º–º–∞ (—Ä—É–±.) *</label>
                    <input type="number" id="billAmount" required min="0" step="0.01" value="0">
                </div>
                
                <div class="form-group">
                    <label for="billVolume">–û–±—ä–µ–º (–∫–í—Ç¬∑—á, –º¬≥ –∏ —Ç.–¥.)</label>
                    <input type="number" id="billVolume" step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="billUnit">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                    <input type="text" id="billUnit" value="–µ–¥.">
                </div>
                
                <div class="form-group">
                    <label for="billTypeSelect">–¢–∏–ø —Å—á–µ—Ç–∞ *</label>
                    <select id="billTypeSelect" required>
                        <option value="general">–û–±—â–∏–π —Å—á–µ—Ç</option>
                        <option value="individual">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å—á–µ—Ç</option>
                    </select>
                </div>
                
                <div class="form-group" id="billTenantGroup" style="display: none;">
                    <label for="billTenant">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä *</label>
                    <select id="billTenant">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="billDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="billDescription" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç–µ"></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal('billModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-success" id="saveBillBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <div class="modal-overlay" id="paymentModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–í–Ω–µ—Å–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã</h3>
                    <button class="close-modal" onclick="closeModal('paymentModal')">√ó</button>
                </div>
                
                <div class="form-group">
                    <p><strong>–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä:</strong> <span id="paymentTenantName"></span></p>
                    <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> <span id="paymentTotalAmount"></span></p>
                    <p><strong>–£–∂–µ –æ–ø–ª–∞—á–µ–Ω–æ:</strong> <span id="paymentPaidAmount"></span></p>
                    <p><strong>–û—Å—Ç–∞–ª–æ—Å—å –æ–ø–ª–∞—Ç–∏—Ç—å:</strong> <span id="paymentRemaining"></span></p>
                </div>
                
                <div class="form-group">
                    <label for="paymentAmount">–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã *</label>
                    <input type="number" id="paymentAmount" required min="0" step="0.01" value="0">
                </div>
                
                <div class="form-group">
                    <label for="paymentDate">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç–∞</label>
                    <input type="date" id="paymentDate">
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal('paymentModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-success" id="savePaymentBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
                </div>
            </div>
        </div>
        
        <div class="modal-overlay" id="activityModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalActivityTitle">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
                    <button class="close-modal" onclick="closeModal('activityModal')">√ó</button>
                </div>
                
                <div class="form-group">
                    <label for="activityName">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ *</label>
                    <input type="text" id="activityName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–≤—Ç–æ–º–æ–π–∫–∞ —Å–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è">
                </div>
                
                <div class="form-group">
                    <label for="activityCoefficient">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ *</label>
                    <input type="number" id="activityCoefficient" required min="0.5" max="3.0" step="0.1" value="1.0">
                    <small style="color: #64748b;">–û—Ç 0.5 (–Ω–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ) –¥–æ 3.0 (–≤—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ)</small>
                </div>
                
                <div class="form-group">
                    <label for="activityDayType">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã *</label>
                    <select id="activityDayType" required>
                        <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å (8-10 —á–∞—Å–æ–≤)</option>
                        <option value="extended">–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å (12-16 —á–∞—Å–æ–≤)</option>
                        <option value="24h">–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (24 —á–∞—Å–∞)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="activityDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="activityDescription" rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal('activityModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-success" id="saveActivityBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏ v2.2 (—Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)</p>
            <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ GitHub. –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–µ.</p>
            <p id="storageIndicator" style="margin-top: 10px; font-size: 0.8rem; color: #94a3b8;"></p>
        </div>
    </div>

    <script>
        // ============================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´
        // ============================================
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub
        const GITHUB_CONFIG = {
            TOKEN: localStorage.getItem('github_token') || '',
            REPO: localStorage.getItem('github_repo') || '',
            BRANCH: localStorage.getItem('github_branch') || 'main',
            DATA_FILE: 'data.json'
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const AppState = {
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            tenants: [],
            bills: [],
            meterReadings: {},
            invoices: [],
            activityTypes: [
                { id: 1, name: '–†–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è', coefficient: 1.0, dayType: 'normal', description: '–ú–∞–≥–∞–∑–∏–Ω –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –æ–¥–µ–∂–¥—ã –∏ —Ç.–¥.' },
                { id: 2, name: '–ö–∞—Ñ–µ, —Ä–µ—Å—Ç–æ—Ä–∞–Ω', coefficient: 1.3, dayType: 'extended', description: '–ó–∞–≤–µ–¥–µ–Ω–∏—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è' },
                { id: 3, name: '–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å', coefficient: 1.2, dayType: 'extended', description: '–°—Ç–∞–Ω—Ü–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π' },
                { id: 4, name: '–ê–≤—Ç–æ–º–æ–π–∫–∞', coefficient: 1.2, dayType: '24h', description: '–ê–≤—Ç–æ–º–æ–π–∫–∞ —Å–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏–ª–∏ —Ä—É—á–Ω–∞—è' },
                { id: 5, name: '–û—Ñ–∏—Å', coefficient: 1.0, dayType: 'normal', description: '–û—Ñ–∏—Å–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è' },
                { id: 6, name: '–°–∫–ª–∞–¥', coefficient: 0.8, dayType: 'normal', description: '–°–∫–ª–∞–¥—Å–∫–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è' },
                { id: 7, name: '–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã', coefficient: 1.1, dayType: 'extended', description: '–ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∞—è, –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è' },
                { id: 8, name: '–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä', coefficient: 1.3, dayType: 'extended', description: '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∑–∞–ª, —Ç—Ä–µ–Ω–∞–∂–µ—Ä—ã' }
            ],
            settings: {
                dayTypeCoefficients: {
                    normal: 1.0,
                    extended: 1.3,
                    '24h': 1.8
                },
                mopArea: 150,
                mopCostPerSqm: 100,
                electricityLossPercent: 5
            },
            _meta: {
                lastSync: null,
                version: '2.2.0',
                userId: localStorage.getItem('utilityAppUserId') || null,
                storageMode: 'local' // 'local' –∏–ª–∏ 'github'
            }
        };
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentEditId = null;
        let billsChart = null;
        let paymentChart = null;
        let billsPeriod = 3;
        let githubInitialized = false;
        let autoSaveInterval = null;
        
        // ============================================
        // –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° GITHUB API
        // ============================================
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function generateUserId() {
            if (!AppState._meta.userId) {
                const userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                AppState._meta.userId = userId;
                localStorage.setItem('utilityAppUserId', userId);
            }
            return AppState._meta.userId;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ GitHub
        function checkGitHubConfig() {
            return !!(GITHUB_CONFIG.TOKEN && GITHUB_CONFIG.REPO);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ GitHub
        async function loadFromGitHub() {
            if (!checkGitHubConfig()) {
                console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
                return { success: false, message: '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞' };
            }
            
            try {
                showAlert('info', '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–±–ª–∞–∫–∞ GitHub...');
                
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.REPO}/contents/${GITHUB_CONFIG.DATA_FILE}`,
                    {
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
                        return { success: true, message: '–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π' };
                    }
                    
                    const errorText = await response.text();
                    throw new Error(`–û—à–∏–±–∫–∞ GitHub API (${response.status}): ${errorText}`);
                }
                
                const data = await response.json();
                
                if (!data.content) {
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ GitHub');
                }
                
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64 —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                const decodedContent = atob(data.content.replace(/\n/g, ''));
                const content = JSON.parse(decodedContent);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ AppState
                Object.keys(content).forEach(key => {
                    AppState[key] = content[key];
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                AppState._meta.lastSync = new Date().toISOString();
                AppState._meta.userId = generateUserId();
                AppState._meta.storageMode = 'github';
                
                githubInitialized = true;
                
                console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub');
                updateStorageStatus();
                
                return { 
                    success: true, 
                    message: '‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞ GitHub!' 
                };
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub:', error);
                AppState._meta.storageMode = 'local';
                updateStorageStatus();
                
                return { 
                    success: false, 
                    message: '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub: ' + error.message 
                };
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ GitHub
        async function saveToGitHub() {
            if (!checkGitHubConfig()) {
                console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ');
                return await saveToLocalStorage();
            }
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                AppState._meta.lastSync = new Date().toISOString();
                AppState._meta.userId = generateUserId();
                AppState._meta.storageMode = 'github';
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JSON
                const content = JSON.stringify(AppState, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π SHA —Ñ–∞–π–ª–∞
                let sha = null;
                
                try {
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${GITHUB_CONFIG.REPO}/contents/${GITHUB_CONFIG.DATA_FILE}`,
                        {
                            headers: {
                                'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (getResponse.ok) {
                        const fileData = await getResponse.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                    console.log('–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π');
                }
                
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
                const requestBody = {
                    message: `Auto-save utility data - ${new Date().toLocaleString('ru-RU')}`,
                    content: encodedContent,
                    branch: GITHUB_CONFIG.BRANCH
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º SHA –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (sha) {
                    requestBody.sha = sha;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.REPO}/contents/${GITHUB_CONFIG.DATA_FILE}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify(requestBody)
                    }
                );
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`GitHub API error: ${JSON.stringify(errorData.message || errorData)}`);
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ GitHub');
                githubInitialized = true;
                updateStorageStatus();
                
                return { 
                    success: true, 
                    message: '‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ GitHub!' 
                };
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ GitHub:', error);
                
                // –ü—Ä–æ–±—É–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                const localResult = await saveToLocalStorage();
                
                return { 
                    success: false, 
                    message: '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ GitHub: ' + error.message,
                    localBackup: localResult.success
                };
            }
        }
        
        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å GitHub
        async function testGitHubConnection() {
            if (!checkGitHubConfig()) {
                return { success: false, message: '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞' };
            }
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.REPO}`,
                    {
                        headers: {
                            'Authorization': `token ${GITHUB_CONFIG.TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.ok) {
                    return { 
                        success: true, 
                        message: '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å GitHub —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!' 
                    };
                } else {
                    return { 
                        success: false, 
                        message: `‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${response.status} ${response.statusText}` 
                    };
                }
            } catch (error) {
                return { 
                    success: false, 
                    message: '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message 
                };
            }
        }
        
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function syncWithGitHub() {
            const syncButton = document.getElementById('syncButton');
            const originalText = syncButton.innerHTML;
            
            if (syncButton) {
                syncButton.innerHTML = 'üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                syncButton.disabled = true;
            }
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
                const loadResult = await loadFromGitHub();
                
                if (!loadResult.success && loadResult.message.includes('–Ω–µ –Ω–∞–π–¥–µ–Ω')) {
                    // –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
                    const saveResult = await saveToGitHub();
                    
                    if (saveResult.success) {
                        showAlert('success', saveResult.message);
                    } else {
                        showAlert('warning', '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ. ' + saveResult.message);
                    }
                } else if (loadResult.success) {
                    // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ø–µ—à–Ω–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    const saveResult = await saveToGitHub();
                    
                    if (saveResult.success) {
                        showAlert('success', '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                    } else {
                        showAlert('warning', '–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ. ' + saveResult.message);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    updateAllViews();
                } else {
                    showAlert('danger', loadResult.message);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateGitHubStatusInfo();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                showAlert('danger', '‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + error.message);
            } finally {
                if (syncButton) {
                    syncButton.innerHTML = originalText;
                    syncButton.disabled = false;
                }
            }
        }
        
        // ============================================
        // –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (BACKUP)
        // ============================================
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        async function loadFromLocalStorage() {
            try {
                const savedState = localStorage.getItem('utilityAppDataExtended');
                if (savedState) {
                    const data = JSON.parse(savedState);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    if (data.tenants) AppState.tenants = data.tenants;
                    if (data.bills) AppState.bills = data.bills;
                    if (data.meterReadings) AppState.meterReadings = data.meterReadings;
                    if (data.invoices) AppState.invoices = data.invoices;
                    if (data.activityTypes) AppState.activityTypes = data.activityTypes;
                    if (data.settings) AppState.settings = data.settings;
                    if (data.currentMonth !== undefined) AppState.currentMonth = data.currentMonth;
                    if (data.currentYear !== undefined) AppState.currentYear = data.currentYear;
                    if (data._meta) AppState._meta = { ...AppState._meta, ...data._meta };
                    
                    console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–±–ª–∞—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
                    if (checkGitHubConfig()) {
                        AppState._meta.storageMode = 'github';
                    } else {
                        AppState._meta.storageMode = 'local';
                    }
                    
                    updateStorageStatus();
                    
                    return { success: true, message: '–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞' };
                }
                return { success: false, message: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ' };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
                return { success: false, message: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: ' + error.message };
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        async function saveToLocalStorage() {
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                AppState._meta.lastSync = new Date().toISOString();
                AppState._meta.userId = generateUserId();
                AppState._meta.storageMode = 'local';
                
                localStorage.setItem('utilityAppDataExtended', JSON.stringify(AppState));
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
                updateStorageStatus();
                
                return { success: true, message: '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ' };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
                return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: ' + error.message };
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞)
        async function saveData() {
            if (checkGitHubConfig() && githubInitialized) {
                return await saveToGitHub();
            } else {
                return await saveToLocalStorage();
            }
        }
        
        // ============================================
        // –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            await initApp();
        });
        
        async function initApp() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub –∏–∑ localStorage
            loadGitHubConfigFromStorage();
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub
            if (checkGitHubConfig()) {
                const githubResult = await loadFromGitHub();
                
                if (!githubResult.success) {
                    // –ï—Å–ª–∏ GitHub –Ω–µ —É–¥–∞–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º localStorage
                    const localResult = await loadFromLocalStorage();
                    
                    if (!localResult.success) {
                        showAlert('info', '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.');
                    } else {
                        showAlert('warning', '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. ' + githubResult.message);
                    }
                } else {
                    showAlert('success', githubResult.message);
                }
            } else {
                // –ï—Å–ª–∏ GitHub –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
                const localResult = await loadFromLocalStorage();
                
                if (!localResult.success) {
                    showAlert('info', '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–æ –≤–∫–ª–∞–¥–∫–µ GitHub.');
                }
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            updateAllViews();
            updateMonthDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            updateStorageStatus();
            updateGitHubStatusInfo();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            startAutoSave();
            
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            console.log('–†–µ–∂–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏—è:', AppState._meta.storageMode);
            console.log('User ID:', AppState._meta.userId);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ GitHub –∏–∑ localStorage
        function loadGitHubConfigFromStorage() {
            GITHUB_CONFIG.TOKEN = localStorage.getItem('github_token') || '';
            GITHUB_CONFIG.REPO = localStorage.getItem('github_repo') || '';
            GITHUB_CONFIG.BRANCH = localStorage.getItem('github_branch') || 'main';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            if (document.getElementById('githubToken')) {
                document.getElementById('githubToken').value = GITHUB_CONFIG.TOKEN;
                document.getElementById('githubRepo').value = GITHUB_CONFIG.REPO;
                document.getElementById('githubBranch').value = GITHUB_CONFIG.BRANCH;
                document.getElementById('githubDataFile').value = GITHUB_CONFIG.DATA_FILE;
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ GitHub –≤ localStorage
        function saveGitHubConfigToStorage(token, repo, branch) {
            GITHUB_CONFIG.TOKEN = token;
            GITHUB_CONFIG.REPO = repo;
            GITHUB_CONFIG.BRANCH = branch || 'main';
            
            localStorage.setItem('github_token', token);
            localStorage.setItem('github_repo', repo);
            localStorage.setItem('github_branch', branch || 'main');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('githubToken').value = token;
            document.getElementById('githubRepo').value = repo;
            document.getElementById('githubBranch').value = branch || 'main';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            githubInitialized = false;
            
            showAlert('success', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            updateGitHubStatusInfo();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function updateStorageStatus() {
            const statusDiv = document.getElementById('storageStatus');
            const indicator = document.getElementById('storageIndicator');
            
            if (AppState._meta.storageMode === 'github' && checkGitHubConfig()) {
                if (statusDiv) {
                    statusDiv.innerHTML = '<span class="github-status cloud">‚òÅÔ∏è –û–±–ª–∞–∫–æ</span>';
                }
                if (indicator) {
                    indicator.innerHTML = 'üîÑ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –æ–±–ª–∞–∫–æ–º GitHub';
                    indicator.style.color = '#10b981';
                }
            } else {
                if (statusDiv) {
                    statusDiv.innerHTML = '<span class="github-status local">üíæ –õ–æ–∫–∞–ª—å–Ω–æ</span>';
                }
                if (indicator) {
                    indicator.innerHTML = 'üíæ –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ';
                    indicator.style.color = '#f59e0b';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º URL GitHub Pages
            const pagesUrl = document.getElementById('githubPagesUrl');
            if (pagesUrl && GITHUB_CONFIG.REPO) {
                const [username, repo] = GITHUB_CONFIG.REPO.split('/');
                if (username && repo) {
                    pagesUrl.innerHTML = `https://${username}.github.io/${repo}/`;
                    pagesUrl.style.color = '#2563eb';
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—É—Å–µ GitHub
        function updateGitHubStatusInfo() {
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            const statusIcon = document.getElementById('statusIcon');
            const lastSync = document.getElementById('lastSyncTime');
            const userId = document.getElementById('userId');
            const dataSize = document.getElementById('dataSize');
            
            if (checkGitHubConfig()) {
                if (githubInitialized) {
                    if (statusDiv) statusDiv.style.backgroundColor = '#d1fae5';
                    if (statusText) statusText.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –æ–±–ª–∞–∫—É';
                    if (statusIcon) statusIcon.textContent = '‚úÖ';
                } else {
                    if (statusDiv) statusDiv.style.backgroundColor = '#fef3c7';
                    if (statusText) statusText.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ, –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    if (statusIcon) statusIcon.textContent = '‚ö†Ô∏è';
                }
            } else {
                if (statusDiv) statusDiv.style.backgroundColor = '#fee2e2';
                if (statusText) statusText.textContent = '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ';
                if (statusIcon) statusIcon.textContent = '‚ùå';
            }
            
            // –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            if (lastSync) {
                if (AppState._meta.lastSync) {
                    const date = new Date(AppState._meta.lastSync);
                    lastSync.textContent = date.toLocaleString('ru-RU');
                } else {
                    lastSync.textContent = '–ù–∏–∫–æ–≥–¥–∞';
                }
            }
            
            // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (userId) {
                userId.textContent = AppState._meta.userId || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            }
            
            // –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
            if (dataSize) {
                const jsonSize = JSON.stringify(AppState).length;
                const sizeKB = (jsonSize / 1024).toFixed(2);
                dataSize.textContent = `${sizeKB} KB`;
            }
        }
        
        // ============================================
        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
        // ============================================
        
        function setupEventListeners() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) tabContent.classList.add('active');
                    
                    updateTabContent(tabId);
                });
            });
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º
            document.getElementById('prevMonthBtn').addEventListener('click', () => changeMonth(-1));
            document.getElementById('nextMonthBtn').addEventListener('click', () => changeMonth(1));
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤
            document.getElementById('generateInvoicesBtn').addEventListener('click', generateAllInvoices);
            
            // –ö–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            document.getElementById('syncButton').addEventListener('click', syncWithGitHub);
            
            // –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã
            document.getElementById('addTenantBtn').addEventListener('click', () => showAddTenantModal());
            document.getElementById('tenantSearch').addEventListener('input', filterTenants);
            
            // –°—á–µ—Ç—á–∏–∫–∏
            document.getElementById('saveMetersBtn').addEventListener('click', saveAllMeterReadings);
            
            // –°—á–µ—Ç–∞ –†–°–û
            document.getElementById('addGeneralBillBtn').addEventListener('click', () => showAddBillModal('general'));
            document.getElementById('addIndividualBillBtn').addEventListener('click', () => showAddBillModal('individual'));
            
            // –°—á–µ—Ç–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º
            document.getElementById('recalculateBtn').addEventListener('click', recalculateAllInvoices);
            
            // –í–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            document.getElementById('addActivityBtn').addEventListener('click', () => showAddActivityModal());
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('saveDayTypeCoefficientsBtn').addEventListener('click', saveDayTypeCoefficients);
            document.getElementById('saveMopSettingsBtn').addEventListener('click', saveMopSettings);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('importDataBtn').addEventListener('click', () => document.getElementById('importFileInput')?.click());
            document.getElementById('deleteAllDataBtn').addEventListener('click', confirmDeleteAllData);
            document.getElementById('clearDataBtn').addEventListener('click', confirmDeleteAllData);
            
            // GitHub
            document.getElementById('saveGitHubConfigBtn').addEventListener('click', saveGitHubConfig);
            document.getElementById('testGitHubConnectionBtn').addEventListener('click', testGitHubConnectionHandler);
            document.getElementById('forceSyncBtn').addEventListener('click', syncWithGitHub);
            document.getElementById('showInstructionsBtn').addEventListener('click', showGitHubInstructions);
            
            // –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
            document.getElementById('saveTenantBtn').addEventListener('click', () => saveTenant());
            document.getElementById('saveBillBtn').addEventListener('click', () => saveBill());
            document.getElementById('savePaymentBtn').addEventListener('click', () => savePayment());
            document.getElementById('saveActivityBtn').addEventListener('click', () => saveActivity());
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Å—á–µ—Ç–∞
            const billTypeSelect = document.getElementById('billTypeSelect');
            if (billTypeSelect) {
                billTypeSelect.addEventListener('change', function(e) {
                    const tenantGroup = document.getElementById('billTenantGroup');
                    if (tenantGroup) {
                        tenantGroup.style.display = e.target.value === 'individual' ? 'block' : 'none';
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤
            document.querySelectorAll('#billsPeriodSelector .period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#billsPeriodSelector .period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    billsPeriod = this.dataset.period === 'all' ? 'all' : parseInt(this.dataset.period);
                    updateDashboard();
                });
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤
            const importInput = document.createElement('input');
            importInput.type = 'file';
            importInput.id = 'importFileInput';
            importInput.accept = '.json';
            importInput.style.display = 'none';
            importInput.addEventListener('change', handleImportFile);
            document.body.appendChild(importInput);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ GitHub
        async function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const branch = document.getElementById('githubBranch').value.trim() || 'main';
            
            if (!token) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ Personal Access Token');
                return;
            }
            
            if (!repo || !repo.includes('/')) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: username/repo-name');
                return;
            }
            
            saveGitHubConfigToStorage(token, repo, branch);
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            const testResult = await testGitHubConnection();
            showAlert(testResult.success ? 'success' : 'danger', testResult.message);
            
            if (testResult.success) {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ GitHub
                const loadResult = await loadFromGitHub();
                if (loadResult.success) {
                    updateAllViews();
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å GitHub
        async function testGitHubConnectionHandler() {
            const testBtn = document.getElementById('testGitHubConnectionBtn');
            const originalText = testBtn.innerHTML;
            
            testBtn.innerHTML = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            testBtn.disabled = true;
            
            const result = await testGitHubConnection();
            
            testBtn.innerHTML = originalText;
            testBtn.disabled = false;
            
            showAlert(result.success ? 'success' : 'danger', result.message);
            updateGitHubStatusInfo();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GitHub
        function showGitHubInstructions() {
            const instructions = `
                <div style="padding: 20px;">
                    <h2 style="color: #2563eb; margin-bottom: 20px;">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h2>
                    
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h3>üéØ –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub</h3>
                        <ul>
                            <li>–ó–∞–π–¥–∏—Ç–µ –Ω–∞ <a href="https://github.com" target="_blank" style="color: #2563eb;">GitHub.com</a></li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "+" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É ‚Üí "New repository"</li>
                            <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
                                <ul>
                                    <li>Repository name: <strong>utility-app</strong></li>
                                    <li>Description: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏"</li>
                                    <li>Public (–¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)</li>
                                    <li>–ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "Add a README file"</li>
                                </ul>
                            </li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "Create repository"</li>
                        </ul>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h3>üîë –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token</h3>
                        <ol>
                            <li>–ù–∞ GitHub –∑–∞–π–¥–∏—Ç–µ –≤ <strong>Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</strong></li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "Generate new token"</li>
                            <li>–í—ã–±–µ—Ä–∏—Ç–µ "classic" —Ç–æ–∫–µ–Ω</li>
                            <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
                                <ul>
                                    <li>Note: "Utility App Token"</li>
                                    <li>Expiration: "No expiration" (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</li>
                                    <li>Select scopes: –≤—ã–±–µ—Ä–∏—Ç–µ <strong>"repo"</strong> (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º)</li>
                                </ul>
                            </li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "Generate token"</li>
                            <li><strong>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω</strong> (–æ–Ω –ø–æ–∫–∞–∂–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)</li>
                        </ol>
                    </div>
                    
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h3>üåê –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Pages</h3>
                        <ul>
                            <li>–í –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∑–∞–π–¥–∏—Ç–µ –≤ <strong>Settings ‚Üí Pages</strong></li>
                            <li>–í —Ä–∞–∑–¥–µ–ª–µ "Source" –≤—ã–±–µ—Ä–∏—Ç–µ:
                                <ul>
                                    <li>Branch: <strong>main</strong></li>
                                    <li>Folder: <strong>/ (root)</strong></li>
                                </ul>
                            </li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "Save"</li>
                            <li>–ß–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã –≤–∞—à —Å–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: <strong>https://–≤–∞—à-–ª–æ–≥–∏–Ω.github.io/utility-app/</strong></li>
                        </ul>
                    </div>
                    
                    <div style="background: #e7f7e7; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h3>‚öôÔ∏è –®–∞–≥ 4: –í—Å—Ç–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —ç—Ç—É —Ñ–æ—Ä–º—É</h3>
                        <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:</p>
                        <ul>
                            <li><strong>Personal Access Token:</strong> –≤—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω</li>
                            <li><strong>–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:</strong> –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–≤–∞—à-–ª–æ–≥–∏–Ω/–Ω–∞–∑–≤–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"</li>
                            <li><strong>–í–µ—Ç–∫–∞:</strong> –æ–±—ã—á–Ω–æ "main"</li>
                        </ul>
                        <p>–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", –∑–∞—Ç–µ–º "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"</p>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; border: 1px solid #ffeaa7;">
                        <h3>‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</h3>
                        <ul>
                            <li>–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ</li>
                            <li>–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö GitHub –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</li>
                            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</li>
                        </ul>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.id = 'githubInstructionsModal';
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ GitHub</h3>
                        <button class="close-modal" onclick="document.getElementById('githubInstructionsModal').remove()">√ó</button>
                    </div>
                    ${instructions}
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="document.getElementById('githubInstructionsModal').remove()">–ü–æ–Ω—è—Ç–Ω–æ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ============================================
        // –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï
        // ============================================
        
        function startAutoSave() {
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Ç–µ—Å—Ç–∞) –∏–ª–∏ 2 –º–∏–Ω—É—Ç—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
            autoSaveInterval = setInterval(async () => {
                if (checkGitHubConfig() && githubInitialized) {
                    const result = await saveToGitHub();
                    if (result.success) {
                        console.log('–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ GitHub –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    }
                } else {
                    const result = await saveToLocalStorage();
                    if (result.success) {
                        console.log('–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –≤—ã–ø–æ–ª–Ω–µ–Ω–æ');
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                updateGitHubStatusInfo();
            }, 30000); // 30 —Å–µ–∫—É–Ω–¥
        }
        
        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', async function(e) {
            stopAutoSave();
            
            if (checkGitHubConfig() && githubInitialized) {
                await saveToGitHub();
            } else {
                await saveToLocalStorage();
            }
        });
        
        // ============================================
        // –û–°–ù–û–í–ù–û–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ============================================
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞
        function changeMonth(delta) {
            AppState.currentMonth += delta;
            
            if (AppState.currentMonth < 0) {
                AppState.currentMonth = 11;
                AppState.currentYear--;
            } else if (AppState.currentMonth > 11) {
                AppState.currentMonth = 0;
                AppState.currentYear++;
            }
            
            updateMonthDisplay();
            updateAllViews();
            saveData();
            
            showAlert('success', `–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ ${getMonthName(AppState.currentMonth)} ${AppState.currentYear}`);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Å—è—Ü–∞
        function updateMonthDisplay() {
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            
            const display = document.getElementById('currentMonthDisplay');
            if (display) display.textContent = `${monthNames[AppState.currentMonth]} ${AppState.currentYear}`;
            
            const meterDisplay = document.getElementById('meterPeriodDisplay');
            if (meterDisplay) meterDisplay.innerHTML = `<strong>${monthNames[AppState.currentMonth]} ${AppState.currentYear}</strong>`;
            
            const dashboardDisplay = document.getElementById('dashboardMonthDisplay');
            if (dashboardDisplay) dashboardDisplay.textContent = `${monthNames[AppState.currentMonth]} ${AppState.currentYear}`;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–∞
        function getMonthName(monthIndex) {
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            return monthNames[monthIndex];
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
        function updateAllViews() {
            updateDashboard();
            renderTenantsTable();
            renderMetersInput();
            renderBillsTable();
            renderInvoicesTable();
            renderActivitiesTable();
            renderSettings();
            updateGitHubStatusInfo();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–∫–ª–∞–¥–∫–∏
        function updateTabContent(tabId) {
            switch(tabId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'tenants':
                    renderTenantsTable();
                    break;
                case 'meters':
                    renderMetersInput();
                    break;
                case 'bills':
                    renderBillsTable();
                    break;
                case 'invoices':
                    renderInvoicesTable();
                    break;
                case 'activities':
                    renderActivitiesTable();
                    break;
                case 'settings':
                    renderSettings();
                    break;
                case 'github':
                    updateGitHubStatusInfo();
                    break;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞
        function updateDashboard() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
            document.getElementById('tenantsCount').textContent = AppState.tenants.length;
            document.getElementById('billsCount').textContent = AppState.bills.length;
            document.getElementById('invoicesCount').textContent = AppState.invoices.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            updateFinancialStats();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–ø–ª–∞—Ç
            updatePaymentStats();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            updateCharts();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç—É—Å–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
            updateTenantsStatusTable();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
            updateResourceDistribution();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            updateMonthlyData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ –º–µ—Å—è—Ü
            updateMonthlyChanges();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        function updateFinancialStats() {
            // –û–±—â–∞—è —Å—É–º–º–∞ —Å—á–µ—Ç–æ–≤ –†–°–û –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const currentBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear
            );
            const totalBillsAmount = currentBills.reduce((sum, bill) => sum + (bill.amount || 0), 0);
            document.getElementById('totalBillsAmount').textContent = formatCurrencyShort(totalBillsAmount);
            
            // –û–±—â–∞—è —Å—É–º–º–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            const totalInvoicesAmount = currentInvoices.reduce((sum, inv) => sum + (inv.totalAmount || 0), 0);
            document.getElementById('totalInvoicesAmount').textContent = formatCurrencyShort(totalInvoicesAmount);
            
            // –û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const totalPaidAmount = currentInvoices.reduce((sum, inv) => sum + (inv.paidAmount || 0), 0);
            document.getElementById('totalPaidAmount').textContent = formatCurrencyShort(totalPaidAmount);
            
            // –î–µ–±–∏—Ç–æ—Ä—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const totalDebtAmount = totalInvoicesAmount - totalPaidAmount;
            document.getElementById('totalDebtAmount').textContent = formatCurrencyShort(totalDebtAmount);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–ø–ª–∞—Ç
        function updatePaymentStats() {
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            
            const fullyPaid = currentInvoices.filter(inv => (inv.paidAmount || 0) >= (inv.totalAmount || 0)).length;
            const partialPaid = currentInvoices.filter(inv => (inv.paidAmount || 0) > 0 && (inv.paidAmount || 0) < (inv.totalAmount || 0)).length;
            const unpaid = currentInvoices.filter(inv => (inv.paidAmount || 0) === 0).length;
            
            const totalInvoices = currentInvoices.length;
            const paymentRate = totalInvoices > 0 ? Math.round((fullyPaid / totalInvoices) * 100) : 0;
            
            document.getElementById('fullyPaidCount').textContent = fullyPaid;
            document.getElementById('partialPaidCount').textContent = partialPaid;
            document.getElementById('unpaidCount').textContent = unpaid;
            document.getElementById('paymentRate').textContent = `${paymentRate}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –æ–ø–ª–∞—Ç
            updatePaymentChart(fullyPaid, partialPaid, unpaid);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ –º–µ—Å—è—Ü
        function updateMonthlyChanges() {
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
            const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
            const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
            
            const currentTenantsCount = AppState.tenants.length;
            const prevTenantsCount = AppState.tenants.filter(t => {
                return true;
            }).length;
            
            const tenantsChange = currentTenantsCount - prevTenantsCount;
            const tenantsChangeElem = document.getElementById('tenantsChange');
            if (tenantsChangeElem) {
                tenantsChangeElem.textContent = `${tenantsChange >= 0 ? '+' : ''}${tenantsChange} –∑–∞ –º–µ—Å—è—Ü`;
                tenantsChangeElem.className = `stat-change ${tenantsChange >= 0 ? 'positive' : 'negative'}`;
            }
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—á–µ—Ç–æ–≤ –†–°–û
            const currentBillsCount = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear
            ).length;
            
            const prevBillsCount = AppState.bills.filter(
                bill => bill.month === prevMonth && bill.year === prevYear
            ).length;
            
            const billsChange = currentBillsCount - prevBillsCount;
            const billsChangeElem = document.getElementById('billsChange');
            if (billsChangeElem) {
                billsChangeElem.textContent = `${billsChange >= 0 ? '+' : ''}${billsChange} –∑–∞ –º–µ—Å—è—Ü`;
                billsChangeElem.className = `stat-change ${billsChange >= 0 ? 'positive' : 'negative'}`;
            }
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—á–µ—Ç–æ–≤ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º
            const currentInvoicesCount = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            ).length;
            
            const prevInvoicesCount = AppState.invoices.filter(
                inv => inv.month === prevMonth && inv.year === prevYear
            ).length;
            
            const invoicesChange = currentInvoicesCount - prevInvoicesCount;
            const invoicesChangeElem = document.getElementById('invoicesChange');
            if (invoicesChangeElem) {
                invoicesChangeElem.textContent = `${invoicesChange >= 0 ? '+' : ''}${invoicesChange} –∑–∞ –º–µ—Å—è—Ü`;
                invoicesChangeElem.className = `stat-change ${invoicesChange >= 0 ? 'positive' : 'negative'}`;
            }
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –æ–ø–ª–∞—Ç—ã
            const currentPaymentRate = parseInt(document.getElementById('paymentRate').textContent) || 0;
            const prevInvoices = AppState.invoices.filter(
                inv => inv.month === prevMonth && inv.year === prevYear
            );
            
            const prevFullyPaid = prevInvoices.filter(inv => (inv.paidAmount || 0) >= (inv.totalAmount || 0)).length;
            const prevTotalInvoices = prevInvoices.length;
            const prevPaymentRate = prevTotalInvoices > 0 ? Math.round((prevFullyPaid / prevTotalInvoices) * 100) : 0;
            
            const paymentChange = currentPaymentRate - prevPaymentRate;
            const paymentChangeElem = document.getElementById('paymentChange');
            if (paymentChangeElem) {
                paymentChangeElem.textContent = `${paymentChange >= 0 ? '+' : ''}${paymentChange}% –∑–∞ –º–µ—Å—è—Ü`;
                paymentChangeElem.className = `stat-change ${paymentChange >= 0 ? 'positive' : 'negative'}`;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function updateCharts() {
            updateBillsChart();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å—á–µ—Ç–æ–≤ –†–°–û
        function updateBillsChart() {
            const ctx = document.getElementById('billsChart');
            if (!ctx) return;
            
            const canvasCtx = ctx.getContext('2d');
            if (!canvasCtx) return;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let monthsToShow = [];
            let currentMonth = AppState.currentMonth;
            let currentYear = AppState.currentYear;
            
            if (billsPeriod === 'all') {
                // –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π –º–µ—Å—è—Ü –≤ –¥–∞–Ω–Ω—ã—Ö
                let earliestMonth = currentMonth;
                let earliestYear = currentYear;
                
                AppState.bills.forEach(bill => {
                    if (bill.year < earliestYear || (bill.year === earliestYear && bill.month < earliestMonth)) {
                        earliestMonth = bill.month;
                        earliestYear = bill.year;
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Å—è—Ü—ã –æ—Ç —Å–∞–º–æ–≥–æ —Ä–∞–Ω–Ω–µ–≥–æ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ
                let month = earliestMonth;
                let year = earliestYear;
                
                while (year < currentYear || (year === currentYear && month <= currentMonth)) {
                    monthsToShow.push({ month: month, year: year });
                    month++;
                    if (month > 11) {
                        month = 0;
                        year++;
                    }
                }
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 24 –º–µ—Å—è—Ü–µ–≤ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                if (monthsToShow.length > 24) {
                    monthsToShow = monthsToShow.slice(-24);
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥
                for (let i = billsPeriod - 1; i >= 0; i--) {
                    let month = currentMonth - i;
                    let year = currentYear;
                    
                    while (month < 0) {
                        month += 12;
                        year--;
                    }
                    
                    monthsToShow.push({ month: month, year: year });
                }
            }
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const labels = monthsToShow.map(({ month, year }) => {
                const monthName = getMonthName(month);
                return monthName.length > 3 ? monthName.substring(0, 3) : monthName;
            });
            
            const billsData = monthsToShow.map(({ month, year }) => {
                const monthBills = AppState.bills.filter(bill => bill.month === month && bill.year === year);
                return monthBills.reduce((sum, bill) => sum + (bill.amount || 0), 0);
            });
            
            // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            if (billsChart) {
                billsChart.destroy();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
            billsChart = new Chart(canvasCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–°—á–µ—Ç–∞ –†–°–û',
                        data: billsData,
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `–°—É–º–º–∞: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrencyShort(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã –æ–ø–ª–∞—Ç
        function updatePaymentChart(fullyPaid, partialPaid, unpaid) {
            const ctx = document.getElementById('paymentChart');
            if (!ctx) return;
            
            const canvasCtx = ctx.getContext('2d');
            if (!canvasCtx) return;
            
            // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            if (paymentChart) {
                paymentChart.destroy();
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
            paymentChart = new Chart(canvasCtx, {
                type: 'doughnut',
                data: {
                    labels: ['–û–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é', '–ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ', '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ'],
                    datasets: [{
                        data: [fullyPaid, partialPaid, unpaid],
                        backgroundColor: [
                            '#10b981',
                            '#f59e0b',
                            '#ef4444'
                        ],
                        borderColor: [
                            '#0da271',
                            '#d97706',
                            '#dc2626'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
        function updateResourceDistribution() {
            const currentBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear
            );
            
            const resourceTypes = {
                electricity: { name: '‚ö° –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è', amount: 0 },
                gas: { name: 'üî• –ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ', amount: 0 },
                water: { name: 'üíß –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ', amount: 0 },
                trash: { name: 'üóëÔ∏è –í—ã–≤–æ–∑ –¢–ö–û', amount: 0 },
                other: { name: 'üì¶ –ü—Ä–æ—á–µ–µ', amount: 0 }
            };
            
            currentBills.forEach(bill => {
                if (resourceTypes[bill.type]) {
                    resourceTypes[bill.type].amount += bill.amount || 0;
                } else {
                    resourceTypes.other.amount += bill.amount || 0;
                }
            });
            
            let html = '';
            Object.values(resourceTypes).forEach(resource => {
                if (resource.amount > 0) {
                    html += `
                        <div class="resource-item">
                            <div class="resource-name">${resource.name}</div>
                            <div class="resource-amount">${formatCurrency(resource.amount)}</div>
                        </div>
                    `;
                }
            });
            
            if (html === '') {
                html = '<p style="text-align: center; color: #64748b; padding: 2rem;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>';
            }
            
            const container = document.getElementById('resourceDistribution');
            if (container) container.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function updateMonthlyData() {
            // –°—á–µ—Ç–∞ –†–°–û –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const currentBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear
            );
            
            let billsHtml = '';
            if (currentBills.length > 0) {
                currentBills.forEach(bill => {
                    const typeNames = {
                        electricity: '‚ö° –≠–ª-–≤–æ',
                        gas: 'üî• –ì–∞–∑',
                        water: 'üíß –í–æ–¥–∞',
                        trash: 'üóëÔ∏è –¢–ö–û',
                        other: 'üì¶ –ü—Ä–æ—á–µ–µ'
                    };
                    
                    const typeName = typeNames[bill.type] || bill.type;
                    billsHtml += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #f1f5f9;">
                            <div style="font-weight: 500;">${typeName}</div>
                            <div style="font-weight: 600;">${formatCurrency(bill.amount)}</div>
                        </div>
                    `;
                });
            } else {
                billsHtml = '<p style="text-align: center; color: #64748b; padding: 1rem;">–ù–µ—Ç —Å—á–µ—Ç–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>';
            }
            
            const billsList = document.getElementById('monthlyBillsList');
            if (billsList) billsList.innerHTML = billsHtml;
            
            // –¢–æ–ø-5 –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –ø–æ —Å—É–º–º–µ —Å—á–µ—Ç–æ–≤
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            
            let topTenantsHtml = '';
            if (currentInvoices.length > 0) {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—É–º–º–µ —Å—á–µ—Ç–∞
                const sortedInvoices = [...currentInvoices].sort((a, b) => (b.totalAmount || 0) - (a.totalAmount || 0));
                
                sortedInvoices.slice(0, 5).forEach((invoice, index) => {
                    const tenant = AppState.tenants.find(t => t.id === invoice.tenantId);
                    if (tenant) {
                        const paidPercent = invoice.totalAmount > 0 ? Math.round((invoice.paidAmount / invoice.totalAmount) * 100) : 0;
                        const statusColor = paidPercent >= 100 ? '#10b981' : paidPercent > 0 ? '#f59e0b' : '#ef4444';
                        
                        topTenantsHtml += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #f1f5f9;">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.9rem;">${index + 1}. ${tenant.name}</div>
                                    <div style="font-size: 0.8rem; color: #64748b;">${formatCurrency(invoice.totalAmount)}</div>
                                </div>
                                <div style="font-size: 0.9rem; color: ${statusColor}; font-weight: 600;">${paidPercent}%</div>
                            </div>
                        `;
                    }
                });
            } else {
                topTenantsHtml = '<p style="text-align: center; color: #64748b; padding: 1rem;">–ù–µ—Ç —Å—á–µ—Ç–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</p>';
            }
            
            const topTenantsList = document.getElementById('topTenantsList');
            if (topTenantsList) topTenantsList.innerHTML = topTenantsHtml;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç—É—Å–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
        function updateTenantsStatusTable() {
            const tbody = document.getElementById('tenantsStatusBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            
            AppState.tenants.forEach(tenant => {
                const invoice = currentInvoices.find(inv => inv.tenantId === tenant.id);
                const activity = AppState.activityTypes.find(a => a.id === tenant.activityTypeId);
                const finalCoefficient = getFinalCoefficient(tenant.activityTypeId);
                
                const row = document.createElement('tr');
                
                let statusBadge = '<span class="badge badge-warning">–ù–µ—Ç —Å—á–µ—Ç–∞</span>';
                let statusText = '–ù–µ—Ç —Å—á–µ—Ç–∞';
                
                if (invoice) {
                    if ((invoice.paidAmount || 0) >= (invoice.totalAmount || 0)) {
                        statusBadge = '<span class="badge badge-success">–û–ø–ª–∞—á–µ–Ω–æ</span>';
                        statusText = '–û–ø–ª–∞—á–µ–Ω–æ';
                    } else if ((invoice.paidAmount || 0) > 0) {
                        statusBadge = '<span class="badge badge-warning">–ß–∞—Å—Ç–∏—á–Ω–æ</span>';
                        statusText = '–ß–∞—Å—Ç–∏—á–Ω–æ';
                    } else {
                        statusBadge = '<span class="badge badge-danger">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>';
                        statusText = '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ';
                    }
                }
                
                row.innerHTML = `
                    <td class="tenant-name" title="${tenant.name}">${tenant.name}</td>
                    <td>${activity ? activity.name : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                    <td><strong>${finalCoefficient.toFixed(2)}</strong></td>
                    <td>${invoice ? formatCurrencyShort(invoice.totalAmount || 0) : '‚Äî'}</td>
                    <td>${statusBadge}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
        function getFinalCoefficient(activityTypeId) {
            const activity = AppState.activityTypes.find(a => a.id === activityTypeId);
            if (!activity) return 1.0;
            
            const dayTypeCoefficient = AppState.settings.dayTypeCoefficients[activity.dayType] || 1.0;
            return activity.coefficient * dayTypeCoefficient;
        }
        
        // ============================================
        // –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –î–ê–ù–ù–´–ú–ò
        // ============================================
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
        function renderTenantsTable() {
            const tbody = document.getElementById('tenantsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (AppState.tenants.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" style="text-align: center; padding: 40px; color: #666;">–ù–µ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞"</td>`;
                tbody.appendChild(row);
                return;
            }
            
            AppState.tenants.forEach(tenant => {
                const row = document.createElement('tr');
                const activity = AppState.activityTypes.find(a => a.id === tenant.activityTypeId);
                const finalCoefficient = getFinalCoefficient(tenant.activityTypeId);
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç—á–∏–∫–∞—Ö
                let metersInfo = '';
                if (tenant.electricityMeterId) {
                    metersInfo += `<span class="meter-type-badge meter-type-individual">–≠–ª: ${tenant.electricityMeterId}</span>`;
                }
                if (tenant.waterMeterId) {
                    metersInfo += `<span class="meter-type-badge meter-type-individual">–í–æ–¥–∞: ${tenant.waterMeterId}</span>`;
                }
                if (tenant.groupMeterId) {
                    metersInfo += `<span class="meter-type-badge meter-type-group">–ì—Ä—É–ø–ø–∞: ${tenant.groupMeterId}</span>`;
                }
                if (!metersInfo) {
                    metersInfo = '–ë–µ–∑ —Å—á–µ—Ç—á–∏–∫–æ–≤';
                }
                
                row.innerHTML = `
                    <td>${tenant.id}</td>
                    <td><strong>${tenant.name}</strong></td>
                    <td>${tenant.area} –º¬≤</td>
                    <td>${activity ? activity.name : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                    <td><strong>${finalCoefficient.toFixed(2)}</strong></td>
                    <td>${metersInfo}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-primary" onclick="editTenant(${tenant.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="action-btn btn-danger" onclick="deleteTenant(${tenant.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
        function filterTenants() {
            const searchTerm = document.getElementById('tenantSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#tenantsTableBody tr');
            
            rows.forEach(row => {
                const tenantName = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase();
                const isVisible = tenantName?.includes(searchTerm);
                row.style.display = isVisible ? '' : 'none';
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        function showAddTenantModal(tenantId = null) {
            currentEditId = tenantId;
            const isEditMode = tenantId !== null;
            const tenant = isEditMode ? AppState.tenants.find(t => t.id === tenantId) : null;
            
            const title = document.getElementById('modalTenantTitle');
            if (title) {
                title.textContent = isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞' : '–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞';
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('tenantName').value = tenant ? tenant.name : '';
            document.getElementById('tenantArea').value = tenant ? tenant.area : '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const activitySelect = document.getElementById('tenantActivityType');
            if (activitySelect) {
                activitySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</option>' +
                    AppState.activityTypes.map(activity => `
                        <option value="${activity.id}" ${tenant && tenant.activityTypeId === activity.id ? 'selected' : ''}>
                            ${activity.name} (–∫–æ—ç—Ñ—Ñ. ${activity.coefficient}, ${getDayTypeName(activity.dayType)})
                        </option>
                    `).join('');
            }
            
            document.getElementById('electricityMeterId').value = tenant ? tenant.electricityMeterId || '' : '';
            document.getElementById('waterMeterId').value = tenant ? tenant.waterMeterId || '' : '';
            document.getElementById('groupMeterId').value = tenant ? tenant.groupMeterId || '' : '';
            document.getElementById('tenantPhone').value = tenant ? tenant.phone || '' : '';
            document.getElementById('tenantEmail').value = tenant ? tenant.email || '' : '';
            
            openModal('tenantModal');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        async function saveTenant() {
            const isEditMode = currentEditId !== null;
            
            const name = document.getElementById('tenantName').value.trim();
            const areaInput = document.getElementById('tenantArea');
            const area = parseFloat(areaInput.value);
            const activityTypeIdInput = document.getElementById('tenantActivityType');
            const activityTypeId = parseInt(activityTypeIdInput.value);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            if (!name) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞');
                document.getElementById('tenantName').focus();
                return;
            }
            
            if (!area || isNaN(area) || area <= 0) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–ª–æ—â–∞–¥—å (–±–æ–ª—å—à–µ 0)');
                areaInput.focus();
                return;
            }
            
            if (!activityTypeId || isNaN(activityTypeId)) {
                showAlert('warning', '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏');
                activityTypeIdInput.focus();
                return;
            }
            
            if (isEditMode) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
                const tenantIndex = AppState.tenants.findIndex(t => t.id === currentEditId);
                if (tenantIndex === -1) return;
                
                AppState.tenants[tenantIndex] = {
                    ...AppState.tenants[tenantIndex],
                    name: name,
                    area: area,
                    activityTypeId: activityTypeId,
                    electricityMeterId: document.getElementById('electricityMeterId').value.trim() || null,
                    waterMeterId: document.getElementById('waterMeterId').value.trim() || null,
                    groupMeterId: document.getElementById('groupMeterId').value.trim() || null,
                    phone: document.getElementById('tenantPhone').value.trim() || '',
                    email: document.getElementById('tenantEmail').value.trim() || ''
                };
                
                showAlert('success', `–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä "${name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!`);
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
                const newTenant = {
                    id: AppState.tenants.length > 0 ? Math.max(...AppState.tenants.map(t => t.id)) + 1 : 1,
                    name: name,
                    area: area,
                    activityTypeId: activityTypeId,
                    electricityMeterId: document.getElementById('electricityMeterId').value.trim() || null,
                    waterMeterId: document.getElementById('waterMeterId').value.trim() || null,
                    groupMeterId: document.getElementById('groupMeterId').value.trim() || null,
                    phone: document.getElementById('tenantPhone').value.trim() || '',
                    email: document.getElementById('tenantEmail').value.trim() || ''
                };
                
                AppState.tenants.push(newTenant);
                showAlert('success', `–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            closeModal('tenantModal');
            currentEditId = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            renderTenantsTable();
            updateDashboard();
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        function editTenant(id) {
            showAddTenantModal(id);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        async function deleteTenant(id) {
            const tenant = AppState.tenants.find(t => t.id === id);
            if (!tenant) return;
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ "${tenant.name}"?`)) {
                return;
            }
            
            const hasInvoices = AppState.invoices.some(inv => inv.tenantId === id);
            
            if (hasInvoices && !confirm('–£ —ç—Ç–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ –µ—Å—Ç—å —Å—á–µ—Ç–∞. –£–¥–∞–ª–∏—Ç—å –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ —Å—á–µ—Ç–∞–º–∏?')) {
                return;
            }
            
            AppState.tenants = AppState.tenants.filter(t => t.id !== id);
            
            if (hasInvoices) {
                AppState.invoices = AppState.invoices.filter(inv => inv.tenantId !== id);
            }
            
            AppState.bills = AppState.bills.filter(bill => 
                !(bill.billType === 'individual' && bill.tenantId === id)
            );
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', `–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä "${tenant.name}" —É–¥–∞–ª–µ–Ω`);
            
            updateAllViews();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–≤–æ–¥–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤
        function renderMetersInput() {
            const container = document.getElementById('metersInputSection');
            if (!container) return;
            
            const currentMonthKey = `${AppState.currentYear}-${AppState.currentMonth}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü
            if (!AppState.meterReadings[currentMonthKey]) {
                AppState.meterReadings[currentMonthKey] = {
                    electricity: {},
                    water: {},
                    groups: {}
                };
            }
            
            let html = `
                <div class="card">
                    <div class="card-header">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏</div>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 20%">–°—á–µ—Ç—á–∏–∫</th>
                                <th style="width: 30%">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä</th>
                                <th style="width: 15%">–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 20%">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 15%">–†–∞—Å—Ö–æ–¥ (–∫–í—Ç¬∑—á)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏
            AppState.tenants.forEach(tenant => {
                if (tenant.electricityMeterId) {
                    const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
                    const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
                    const prevMonthKey = `${prevYear}-${prevMonth}`;
                    
                    const currentReading = AppState.meterReadings[currentMonthKey]?.electricity?.[tenant.electricityMeterId] || '';
                    const prevReading = AppState.meterReadings[prevMonthKey]?.electricity?.[tenant.electricityMeterId] || 0;
                    const consumption = currentReading ? currentReading - prevReading : 0;
                    
                    html += `
                        <tr>
                            <td><strong>${tenant.electricityMeterId}</strong></td>
                            <td>${tenant.name}</td>
                            <td>${prevReading}</td>
                            <td>
                                <input type="number" 
                                       id="meter-el-${tenant.electricityMeterId}" 
                                       value="${currentReading}" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è"
                                       step="0.01"
                                       min="${prevReading}">
                            </td>
                            <td>${consumption > 0 ? consumption.toFixed(2) : '‚Äî'}</td>
                        </tr>
                    `;
                }
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è - –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å—á–µ—Ç—á–∏–∫–∏</div>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 20%">–°—á–µ—Ç—á–∏–∫</th>
                                <th style="width: 40%">–ì—Ä—É–ø–ø–∞ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤</th>
                                <th style="width: 15%">–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 15%">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 10%">–†–∞—Å—Ö–æ–¥ (–∫–í—Ç¬∑—á)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // –ì—Ä—É–ø–ø–æ–≤—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
            const groupMeters = {};
            AppState.tenants.forEach(tenant => {
                if (tenant.groupMeterId) {
                    if (!groupMeters[tenant.groupMeterId]) {
                        groupMeters[tenant.groupMeterId] = [];
                    }
                    groupMeters[tenant.groupMeterId].push(tenant.name);
                }
            });
            
            Object.keys(groupMeters).forEach(groupId => {
                const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
                const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
                const prevMonthKey = `${prevYear}-${prevMonth}`;
                
                const currentReading = AppState.meterReadings[currentMonthKey]?.groups?.[groupId] || '';
                const prevReading = AppState.meterReadings[prevMonthKey]?.groups?.[groupId] || 0;
                const consumption = currentReading ? currentReading - prevReading : 0;
                
                html += `
                    <tr>
                        <td><strong>${groupId}</strong></td>
                        <td style="font-size: 0.9rem;">${groupMeters[groupId].join(', ')}</td>
                        <td>${prevReading}</td>
                        <td>
                            <input type="number" 
                                   id="meter-group-${groupId}" 
                                   value="${currentReading}" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è"
                                   step="0.01"
                                   min="${prevReading}">
                        </td>
                        <td>${consumption > 0 ? consumption.toFixed(2) : '‚Äî'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</div>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 20%">–°—á–µ—Ç—á–∏–∫</th>
                                <th style="width: 30%">–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä</th>
                                <th style="width: 15%">–ü—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 20%">–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è</th>
                                <th style="width: 15%">–†–∞—Å—Ö–æ–¥ (–º¬≥)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // –°—á–µ—Ç—á–∏–∫–∏ –≤–æ–¥—ã
            AppState.tenants.forEach(tenant => {
                if (tenant.waterMeterId) {
                    const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
                    const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
                    const prevMonthKey = `${prevYear}-${prevMonth}`;
                    
                    const currentReading = AppState.meterReadings[currentMonthKey]?.water?.[tenant.waterMeterId] || '';
                    const prevReading = AppState.meterReadings[prevMonthKey]?.water?.[tenant.waterMeterId] || 0;
                    const consumption = currentReading ? currentReading - prevReading : 0;
                    
                    html += `
                        <tr>
                            <td><strong>${tenant.waterMeterId}</strong></td>
                            <td>${tenant.name}</td>
                            <td>${prevReading}</td>
                            <td>
                                <input type="number" 
                                       id="meter-water-${tenant.waterMeterId}" 
                                       value="${currentReading}" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è"
                                       step="0.01"
                                       min="${prevReading}">
                            </td>
                            <td>${consumption > 0 ? consumption.toFixed(2) : '‚Äî'}</td>
                        </tr>
                    `;
                }
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–∫–∞–∑–∞–Ω–∏–π —Å—á–µ—Ç—á–∏–∫–æ–≤
        async function saveAllMeterReadings() {
            const currentMonthKey = `${AppState.currentYear}-${AppState.currentMonth}`;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
            if (!AppState.meterReadings[currentMonthKey]) {
                AppState.meterReadings[currentMonthKey] = {
                    electricity: {},
                    water: {},
                    groups: {}
                };
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏
            AppState.tenants.forEach(tenant => {
                if (tenant.electricityMeterId) {
                    const input = document.getElementById(`meter-el-${tenant.electricityMeterId}`);
                    if (input && input.value) {
                        AppState.meterReadings[currentMonthKey].electricity[tenant.electricityMeterId] = parseFloat(input.value);
                    }
                }
                
                if (tenant.waterMeterId) {
                    const input = document.getElementById(`meter-water-${tenant.waterMeterId}`);
                    if (input && input.value) {
                        AppState.meterReadings[currentMonthKey].water[tenant.waterMeterId] = parseFloat(input.value);
                    }
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
            const groupMeters = {};
            AppState.tenants.forEach(tenant => {
                if (tenant.groupMeterId) {
                    groupMeters[tenant.groupMeterId] = true;
                }
            });
            
            Object.keys(groupMeters).forEach(groupId => {
                const input = document.getElementById(`meter-group-${groupId}`);
                if (input && input.value) {
                    AppState.meterReadings[currentMonthKey].groups[groupId] = parseFloat(input.value);
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            renderMetersInput();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã —Å—á–µ—Ç–æ–≤ –†–°–û
        function renderBillsTable() {
            const tbody = document.getElementById('rsoBillsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const currentBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear
            );
            
            if (currentBills.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center; padding: 40px; color: #666;">–ù–µ—Ç —Å—á–µ—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –æ—Ç –†–°–û</td>`;
                tbody.appendChild(row);
                return;
            }
            
            currentBills.forEach(bill => {
                const row = document.createElement('tr');
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä–µ—Å—É—Ä—Å–∞
                let typeName = '';
                switch(bill.type) {
                    case 'electricity':
                        typeName = '‚ö° –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è';
                        break;
                    case 'gas':
                        typeName = 'üî• –ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ';
                        break;
                    case 'water':
                        typeName = 'üíß –í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ';
                        break;
                    case 'trash':
                        typeName = 'üóëÔ∏è –í—ã–≤–æ–∑ –¢–ö–û';
                        break;
                    default:
                        typeName = bill.type;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—á–µ—Ç–∞
                let billTypeBadge = '';
                if (bill.billType === 'individual') {
                    billTypeBadge = '<span class="badge badge-warning">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π</span>';
                    
                    // –ù–∞—Ö–æ–¥–∏–º –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
                    const tenant = AppState.tenants.find(t => t.id === bill.tenantId);
                    if (tenant) {
                        typeName += ` (${tenant.name})`;
                    }
                } else {
                    billTypeBadge = '<span class="badge badge-primary">–û–±—â–∏–π</span>';
                }
                
                row.innerHTML = `
                    <td>${formatDate(bill.date)}</td>
                    <td>${typeName}</td>
                    <td>${formatCurrency(bill.amount)}</td>
                    <td style="font-size: 0.9rem;">${bill.volume ? bill.volume + ' ' + bill.unit : bill.description || ''}</td>
                    <td>${billTypeBadge}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-primary" onclick="editBill(${bill.id})">‚úèÔ∏è</button>
                        <button class="action-btn btn-danger" onclick="deleteBill(${bill.id})">üóëÔ∏è</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞
        function showAddBillModal(billType, billId = null) {
            currentEditId = billId;
            const isEditMode = billId !== null;
            const bill = isEditMode ? AppState.bills.find(b => b.id === billId) : null;
            
            const title = document.getElementById('modalBillTitle');
            if (title) {
                title.textContent = isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—á–µ—Ç' : 
                    billType === 'individual' ? '–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å—á–µ—Ç' : '–î–æ–±–∞–≤–∏—Ç—å –æ–±—â–∏–π —Å—á–µ—Ç';
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('billTypeSelect').value = bill ? bill.billType : billType;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
            const tenantSelect = document.getElementById('billTenant');
            if (tenantSelect) {
                tenantSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</option>' +
                    AppState.tenants.map(t => `<option value="${t.id}" ${bill && bill.tenantId === t.id ? 'selected' : ''}>${t.name}</option>`).join('');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
            const tenantGroup = document.getElementById('billTenantGroup');
            if (tenantGroup) {
                tenantGroup.style.display = 
                    (bill ? bill.billType : billType) === 'individual' ? 'block' : 'none';
            }
            
            document.getElementById('billResourceType').value = bill ? bill.type : 'electricity';
            document.getElementById('billAmount').value = bill ? bill.amount : 0;
            document.getElementById('billVolume').value = bill ? bill.volume || '' : '';
            document.getElementById('billUnit').value = bill ? bill.unit || '–µ–¥.' : '–µ–¥.';
            document.getElementById('billDescription').value = bill ? bill.description || '' : '';
            
            openModal('billModal');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        async function saveBill() {
            const isEditMode = currentEditId !== null;
            
            const billType = document.getElementById('billTypeSelect').value;
            const resourceType = document.getElementById('billResourceType').value;
            const amountInput = document.getElementById('billAmount');
            const amount = parseFloat(amountInput.value);
            
            if (billType === 'individual') {
                const tenantId = parseInt(document.getElementById('billTenant').value);
                if (!tenantId) {
                    showAlert('warning', '–í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ —Å—á–µ—Ç–∞');
                    return;
                }
            }
            
            if (!amount || isNaN(amount) || amount <= 0) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É (–±–æ–ª—å—à–µ 0)');
                amountInput.focus();
                return;
            }
            
            if (isEditMode) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å—á–µ—Ç–∞
                const billIndex = AppState.bills.findIndex(b => b.id === currentEditId);
                if (billIndex === -1) return;
                
                AppState.bills[billIndex] = {
                    ...AppState.bills[billIndex],
                    billType: billType,
                    type: resourceType,
                    amount: amount,
                    volume: parseFloat(document.getElementById('billVolume').value) || 0,
                    unit: document.getElementById('billUnit').value || '–µ–¥.',
                    description: document.getElementById('billDescription').value.trim() || '',
                    tenantId: billType === 'individual' ? parseInt(document.getElementById('billTenant').value) : null
                };
                
                showAlert('success', `–°—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!`);
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
                const newBill = {
                    id: AppState.bills.length > 0 ? Math.max(...AppState.bills.map(b => b.id)) + 1 : 1,
                    date: new Date().toISOString().split('T')[0],
                    billType: billType,
                    type: resourceType,
                    amount: amount,
                    volume: parseFloat(document.getElementById('billVolume').value) || 0,
                    unit: document.getElementById('billUnit').value || '–µ–¥.',
                    description: document.getElementById('billDescription').value.trim() || '',
                    month: AppState.currentMonth,
                    year: AppState.currentYear,
                    tenantId: billType === 'individual' ? parseInt(document.getElementById('billTenant').value) : null
                };
                
                AppState.bills.push(newBill);
                showAlert('success', `–°—á–µ—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            closeModal('billModal');
            currentEditId = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            renderBillsTable();
            updateDashboard();
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞
        function editBill(id) {
            const bill = AppState.bills.find(b => b.id === id);
            if (!bill) return;
            
            showAddBillModal(bill.billType, id);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        async function deleteBill(id) {
            const bill = AppState.bills.find(b => b.id === id);
            if (!bill) return;
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç –Ω–∞ —Å—É–º–º—É ${formatCurrency(bill.amount)}?`)) {
                return;
            }
            
            AppState.bills = AppState.bills.filter(b => b.id !== id);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–°—á–µ—Ç —É–¥–∞–ª–µ–Ω');
            
            renderBillsTable();
            updateDashboard();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã —Å—á–µ—Ç–æ–≤ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º
        function renderInvoicesTable() {
            const tbody = document.getElementById('invoicesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            
            if (currentInvoices.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center; padding: 40px; color: #666;">–ù–µ—Ç —Å—á–µ—Ç–æ–≤. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å—á–µ—Ç–∞</td>`;
                tbody.appendChild(row);
                return;
            }
            
            currentInvoices.forEach(invoice => {
                const tenant = AppState.tenants.find(t => t.id === invoice.tenantId);
                if (!tenant) return;
                
                const row = document.createElement('tr');
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                let statusClass = 'status-unpaid';
                let statusText = '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ';
                
                if ((invoice.paidAmount || 0) >= (invoice.totalAmount || 0)) {
                    statusClass = 'status-paid';
                    statusText = '–û–ø–ª–∞—á–µ–Ω–æ';
                } else if ((invoice.paidAmount || 0) > 0) {
                    statusClass = 'status-partial';
                    statusText = '–ß–∞—Å—Ç–∏—á–Ω–æ';
                }
                
                row.innerHTML = `
                    <td><strong>${tenant.name}</strong></td>
                    <td>${getMonthName(invoice.month)} ${invoice.year}</td>
                    <td>${formatCurrency(invoice.totalAmount || 0)}</td>
                    <td>${formatCurrency(invoice.paidAmount || 0)}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-success" onclick="recordPayment(${invoice.id})">üí∞ –û–ø–ª–∞—Ç–∞</button>
                        <button class="action-btn btn-primary" onclick="viewInvoice(${invoice.id})">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤
        async function generateAllInvoices() {
            if (AppState.tenants.length === 0) {
                showAlert('warning', '–ù–µ—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—á–µ—Ç–æ–≤!');
                return;
            }
            
            const currentMonthKey = `${AppState.currentYear}-${AppState.currentMonth}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–±—â–∏–µ —Å—á–µ—Ç–∞ –†–°–û –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const generalBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear && bill.billType === 'general'
            );
            
            if (generalBills.length === 0) {
                showAlert('warning', '–ù–µ—Ç –æ–±—â–∏—Ö —Å—á–µ—Ç–æ–≤ –†–°–û –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü. –î–æ–±–∞–≤—å—Ç–µ —Å—á–µ—Ç–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.');
                return;
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—á–µ—Ç–∞ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü
            AppState.invoices = AppState.invoices.filter(
                inv => !(inv.month === AppState.currentMonth && inv.year === AppState.currentYear)
            );
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—á–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
            AppState.tenants.forEach(tenant => {
                const invoice = calculateInvoiceForTenant(tenant, generalBills, currentMonthKey);
                AppState.invoices.push(invoice);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', `–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å—á–µ—Ç–∞ –¥–ª—è ${AppState.tenants.length} –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤!`);
            
            renderInvoicesTable();
            updateDashboard();
        }
        
        // –†–∞—Å—á–µ—Ç —Å—á–µ—Ç–∞ –¥–ª—è –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
        function calculateInvoiceForTenant(tenant, generalBills, monthKey) {
            // 1. –†–∞—Å—á–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ —Å —É—á–µ—Ç–æ–º —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
            const electricityCost = calculateElectricityCost(tenant, generalBills, monthKey);
            
            // 2. –†–∞—Å—á–µ—Ç –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏
            const gasCost = calculateGasCost(tenant, generalBills);
            
            // 3. –†–∞—Å—á–µ—Ç –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
            const waterCost = calculateWaterCost(tenant, generalBills, monthKey);
            
            // 4. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
            const individualCosts = calculateIndividualCosts(tenant);
            
            // 5. –†–∞—Å—á–µ—Ç –¥–æ–ª–∏ –ú–û–ü —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏
            const mopShare = calculateMopShare(tenant);
            
            // 6. –†–∞—Å—á–µ—Ç –¥—Ä—É–≥–∏—Ö –æ–±—â–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
            const otherCosts = calculateOtherCosts(tenant, generalBills);
            
            // –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
            const totalAmount = (electricityCost || 0) + (gasCost || 0) + (waterCost || 0) + 
                              (individualCosts || 0) + (mopShare || 0) + (otherCosts || 0);
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const activity = AppState.activityTypes.find(a => a.id === tenant.activityTypeId);
            const finalCoefficient = getFinalCoefficient(tenant.activityTypeId);
            
            return {
                id: Date.now() + Math.floor(Math.random() * 1000),
                tenantId: tenant.id,
                month: AppState.currentMonth,
                year: AppState.currentYear,
                createdDate: new Date().toISOString().split('T')[0],
                totalAmount: Math.round(totalAmount * 100) / 100,
                paidAmount: 0,
                details: {
                    electricity: electricityCost || 0,
                    gas: gasCost || 0,
                    water: waterCost || 0,
                    individual: individualCosts || 0,
                    mop: mopShare || 0,
                    other: otherCosts || 0
                },
                breakdown: generateInvoiceBreakdown(tenant, electricityCost || 0, gasCost || 0, waterCost || 0, 
                                                   individualCosts || 0, mopShare || 0, otherCosts || 0, 
                                                   activity, finalCoefficient)
            };
        }
        
        // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏
        function calculateElectricityCost(tenant, generalBills, monthKey) {
            const electricityBill = generalBills.find(bill => bill.type === 'electricity');
            if (!electricityBill) return 0;
            
            const totalAmount = electricityBill.amount || 0;
            const totalVolume = electricityBill.volume || 0;
            
            if (totalAmount <= 0 || totalVolume <= 0) return 0;
            
            const avgPrice = totalAmount / totalVolume;
            
            // –†–∞—Å—á–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–æ —Å—á–µ—Ç—á–∏–∫–∞–º
            let tenantConsumption = 0;
            
            if (tenant.electricityMeterId) {
                // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
                const currentReading = AppState.meterReadings[monthKey]?.electricity?.[tenant.electricityMeterId] || 0;
                const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
                const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
                const prevMonthKey = `${prevYear}-${prevMonth}`;
                const prevReading = AppState.meterReadings[prevMonthKey]?.electricity?.[tenant.electricityMeterId] || 0;
                
                tenantConsumption = currentReading - prevReading;
                if (tenantConsumption < 0) tenantConsumption = 0;
            } else if (tenant.groupMeterId) {
                // –ì—Ä—É–ø–ø–æ–≤–æ–π —Å—á–µ—Ç—á–∏–∫ - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º
                const groupTenants = AppState.tenants.filter(t => t.groupMeterId === tenant.groupMeterId);
                const groupConsumption = getGroupConsumption(tenant.groupMeterId, monthKey);
                
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏—Ç–æ–≥–æ–≤—ã–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º
                const totalCoefficient = groupTenants.reduce((sum, t) => sum + getFinalCoefficient(t.activityTypeId), 0);
                const tenantCoefficient = getFinalCoefficient(tenant.activityTypeId);
                
                if (totalCoefficient > 0) {
                    tenantConsumption = groupConsumption * (tenantCoefficient / totalCoefficient);
                }
            }
            
            // –ü—Ä—è–º–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é
            const directCost = tenantConsumption * avgPrice;
            
            // –£—á–µ—Ç –ø–æ—Ç–µ—Ä—å –≤ —Å–µ—Ç—è—Ö
            const lossPercent = AppState.settings.electricityLossPercent || 5;
            const lossAmount = totalAmount * (lossPercent / 100);
            
            const totalWeightedArea = AppState.tenants.reduce((sum, t) => {
                return sum + (t.area * getFinalCoefficient(t.activityTypeId));
            }, 0);
            
            const tenantWeightedArea = tenant.area * getFinalCoefficient(tenant.activityTypeId);
            const lossShare = totalWeightedArea > 0 ? (tenantWeightedArea / totalWeightedArea) * lossAmount : 0;
            
            return directCost + lossShare;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–æ –≥—Ä—É–ø–ø–æ–≤–æ–º—É —Å—á–µ—Ç—á–∏–∫—É
        function getGroupConsumption(groupId, monthKey) {
            const currentReading = AppState.meterReadings[monthKey]?.groups?.[groupId] || 0;
            const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
            const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
            const prevMonthKey = `${prevYear}-${prevMonth}`;
            const prevReading = AppState.meterReadings[prevMonthKey]?.groups?.[groupId] || 0;
            
            const consumption = currentReading - prevReading;
            return consumption > 0 ? consumption : 0;
        }
        
        // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
        function calculateGasCost(tenant, generalBills) {
            const gasBill = generalBills.find(bill => bill.type === 'gas');
            if (!gasBill) return 0;
            
            const totalAmount = gasBill.amount || 0;
            
            // –†–∞—Å—á–µ—Ç –ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏
            const totalWeightedArea = AppState.tenants.reduce((sum, t) => {
                return sum + (t.area * getFinalCoefficient(t.activityTypeId));
            }, 0);
            
            const tenantWeightedArea = tenant.area * getFinalCoefficient(tenant.activityTypeId);
            
            if (totalWeightedArea <= 0) return 0;
            
            const share = tenantWeightedArea / totalWeightedArea;
            return totalAmount * share;
        }
        
        // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è
        function calculateWaterCost(tenant, generalBills, monthKey) {
            const waterBill = generalBills.find(bill => bill.type === 'water');
            if (!waterBill) return 0;
            
            if (tenant.waterMeterId) {
                // –ü–æ —Å—á–µ—Ç—á–∏–∫—É
                const currentReading = AppState.meterReadings[monthKey]?.water?.[tenant.waterMeterId] || 0;
                const prevMonth = AppState.currentMonth === 0 ? 11 : AppState.currentMonth - 1;
                const prevYear = AppState.currentMonth === 0 ? AppState.currentYear - 1 : AppState.currentYear;
                const prevMonthKey = `${prevYear}-${prevMonth}`;
                const prevReading = AppState.meterReadings[prevMonthKey]?.water?.[tenant.waterMeterId] || 0;
                
                const consumption = currentReading - prevReading;
                if (consumption > 0 && waterBill.volume > 0) {
                    const avgPrice = waterBill.amount / waterBill.volume;
                    return avgPrice * consumption;
                }
            }
            
            // –ü–æ –Ω–æ—Ä–º–∞—Ç–∏–≤—É –∏–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –ø–æ –ø–ª–æ—â–∞–¥–∏
            const totalAmount = waterBill.amount || 0;
            const totalArea = AppState.tenants.reduce((sum, t) => sum + t.area, 0);
            
            if (totalArea <= 0) return 0;
            
            const share = tenant.area / totalArea;
            return totalAmount * share;
        }
        
        // –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç
        function calculateIndividualCosts(tenant) {
            const individualBills = AppState.bills.filter(
                bill => bill.billType === 'individual' && 
                bill.tenantId === tenant.id &&
                bill.month === AppState.currentMonth && 
                bill.year === AppState.currentYear
            );
            
            return individualBills.reduce((sum, bill) => sum + (bill.amount || 0), 0);
        }
        
        // –†–∞—Å—á–µ—Ç –¥–æ–ª–∏ –ú–û–ü
        function calculateMopShare(tenant) {
            const mopCosts = (AppState.settings.mopArea || 0) * (AppState.settings.mopCostPerSqm || 0);
            if (mopCosts <= 0) return 0;
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏
            const totalWeightedArea = AppState.tenants.reduce((sum, t) => {
                return sum + (t.area * getFinalCoefficient(t.activityTypeId));
            }, 0);
            
            const tenantWeightedArea = tenant.area * getFinalCoefficient(tenant.activityTypeId);
            
            if (totalWeightedArea <= 0) return 0;
            
            const share = tenantWeightedArea / totalWeightedArea;
            return mopCosts * share;
        }
        
        // –†–∞—Å—á–µ—Ç –¥—Ä—É–≥–∏—Ö –æ–±—â–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
        function calculateOtherCosts(tenant, generalBills) {
            const otherBills = generalBills.filter(bill => 
                bill.type === 'trash' || bill.type === 'other'
            );
            
            if (otherBills.length === 0) return 0;
            
            const totalAmount = otherBills.reduce((sum, bill) => sum + (bill.amount || 0), 0);
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–ª–æ—â–∞–¥–∏
            const totalArea = AppState.tenants.reduce((sum, t) => sum + t.area, 0);
            
            if (totalArea <= 0) return 0;
            
            const share = tenant.area / totalArea;
            return totalAmount * share;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—á–µ—Ç–∞
        function generateInvoiceBreakdown(tenant, electricity, gas, water, individual, mop, other, activity, finalCoefficient) {
            const totalAmount = electricity + gas + water + individual + mop + other;
            
            const activityInfo = activity ? `
                <tr>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">${activity.name} (–∫–æ—ç—Ñ—Ñ. ${activity.coefficient})</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">${getDayTypeName(activity.dayType)} (–∫–æ—ç—Ñ—Ñ. ${AppState.settings.dayTypeCoefficients[activity.dayType] || 1.0})</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;"><strong>${finalCoefficient.toFixed(2)}</strong></td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;">–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å</td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0;"><strong>${(tenant.area * finalCoefficient).toFixed(2)} –º¬≤</strong> (${tenant.area} –º¬≤ √ó ${finalCoefficient.toFixed(2)})</td>
                </tr>
            ` : '';
            
            return `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <h2 style="color: #2563eb; border-bottom: 2px solid #2563eb; padding-bottom: 10px;">
                        –°—á–µ—Ç –∑–∞ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏
                    </h2>
                    <div style="margin-bottom: 20px;">
                        <p><strong>–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä:</strong> ${tenant.name}</p>
                        <p><strong>–ü–µ—Ä–∏–æ–¥:</strong> ${getMonthName(AppState.currentMonth)} ${AppState.currentYear}</p>
                        <p><strong>–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> ${new Date().toLocaleDateString('ru-RU')}</p>
                        <p><strong>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å:</strong> ${tenant.area} –º¬≤</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; background-color: #f8fafc;">
                        <tbody>
                            ${activityInfo}
                        </tbody>
                    </table>
                    
                    <div style="background-color: #f8fafc; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 0.9em;">
                        <p><strong>–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–∞:</strong></p>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è: —Ä–∞—Å—á–µ—Ç –ø–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è–º —Å—á–µ—Ç—á–∏–∫–∞ —Å —É—á–µ—Ç–æ–º –ø–æ—Ç–µ—Ä—å –≤ —Å–µ—Ç—è—Ö (${AppState.settings.electricityLossPercent}%)</li>
                            <li>–ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å √ó –∏—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç)</li>
                            <li>–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ: –ø–æ —Å—á–µ—Ç—á–∏–∫—É –∏–ª–∏ –ø–æ –ø–ª–æ—â–∞–¥–∏</li>
                            <li>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏: –ø—Ä—è–º—ã–µ —Å—á–µ—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É</li>
                            <li>–ú–û–ü: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏</li>
                        </ul>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background-color: #f1f5f9;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #e2e8f0;">–£—Å–ª—É–≥–∞</th>
                                <th style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">–°—É–º–º–∞ (—Ä—É–±.)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è (—Å —É—á–µ—Ç–æ–º —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –ø–æ—Ç–µ—Ä—å)</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(electricity)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ (–ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏)</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(gas)}</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ –∏ –≤–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏–µ</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(water)}</td>
                            </tr>
                            ${individual > 0 ? `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (–≤—ã–≤–æ–∑ –¢–ö–û –∏ –¥—Ä.)</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(individual)}</td>
                            </tr>
                            ` : ''}
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–î–æ–ª—è –ú–û–ü (–ø–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∏)</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(mop)}</td>
                            </tr>
                            ${other > 0 ? `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–ü—Ä–æ—á–∏–µ –æ–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0;">${formatCurrency(other)}</td>
                            </tr>
                            ` : ''}
                            <tr style="font-weight: bold; background-color: #f8fafc;">
                                <td style="padding: 10px; border: 1px solid #e2e8f0;">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï:</td>
                                <td style="padding: 10px; text-align: right; border: 1px solid #e2e8f0; color: #2563eb;">
                                    ${formatCurrency(totalAmount)}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // –ü–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤
        async function recalculateAllInvoices() {
            if (!confirm('–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü? –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ–± –æ–ø–ª–∞—Ç–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.')) {
                return;
            }
            
            const currentInvoices = AppState.invoices.filter(
                inv => inv.month === AppState.currentMonth && inv.year === AppState.currentYear
            );
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ
            const paymentInfo = {};
            currentInvoices.forEach(inv => {
                paymentInfo[inv.tenantId] = inv.paidAmount || 0;
            });
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å—á–µ—Ç–∞
            AppState.invoices = AppState.invoices.filter(
                inv => !(inv.month === AppState.currentMonth && inv.year === AppState.currentYear)
            );
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ —Å—á–µ—Ç–∞
            const generalBills = AppState.bills.filter(
                bill => bill.month === AppState.currentMonth && bill.year === AppState.currentYear && bill.billType === 'general'
            );
            
            if (generalBills.length === 0) {
                showAlert('warning', '–ù–µ—Ç –æ–±—â–∏—Ö —Å—á–µ—Ç–æ–≤ –†–°–û –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞');
                return;
            }
            
            const currentMonthKey = `${AppState.currentYear}-${AppState.currentMonth}`;
            
            AppState.tenants.forEach(tenant => {
                const invoice = calculateInvoiceForTenant(tenant, generalBills, currentMonthKey);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ
                if (paymentInfo[tenant.id]) {
                    invoice.paidAmount = paymentInfo[tenant.id];
                }
                
                AppState.invoices.push(invoice);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–í—Å–µ —Å—á–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã!');
            
            renderInvoicesTable();
            updateDashboard();
        }
        
        // –í–Ω–µ—Å–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
        function recordPayment(invoiceId) {
            const invoice = AppState.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            const tenant = AppState.tenants.find(t => t.id === invoice.tenantId);
            if (!tenant) return;
            
            const totalAmount = parseFloat(invoice.totalAmount) || 0;
            const paidAmount = parseFloat(invoice.paidAmount) || 0;
            const remaining = totalAmount - paidAmount;
            
            document.getElementById('paymentTenantName').textContent = tenant.name;
            document.getElementById('paymentTotalAmount').textContent = formatCurrency(totalAmount);
            document.getElementById('paymentPaidAmount').textContent = formatCurrency(paidAmount);
            document.getElementById('paymentRemaining').textContent = formatCurrency(remaining);
            document.getElementById('paymentAmount').value = remaining;
            document.getElementById('paymentAmount').max = remaining;
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å—á–µ—Ç–∞
            currentEditId = invoiceId;
            
            openModal('paymentModal');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
        async function savePayment() {
            const invoiceId = currentEditId;
            const invoice = AppState.invoices.find(inv => inv.id === invoiceId);
            
            if (!invoice) return;
            
            const paymentAmountInput = document.getElementById('paymentAmount');
            const paymentAmount = parseFloat(paymentAmountInput.value);
            
            if (isNaN(paymentAmount) || paymentAmount <= 0) {
                showAlert('warning', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –æ–ø–ª–∞—Ç—ã');
                if (paymentAmountInput) paymentAmountInput.focus();
                return;
            }
            
            const totalAmount = parseFloat(invoice.totalAmount) || 0;
            const paidAmount = parseFloat(invoice.paidAmount) || 0;
            const remaining = totalAmount - paidAmount;
            
            if (paymentAmount > remaining) {
                showAlert('warning', `–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ (${formatCurrency(remaining)})`);
                if (paymentAmountInput) paymentAmountInput.focus();
                return;
            }
            
            invoice.paidAmount = paidAmount + paymentAmount;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            closeModal('paymentModal');
            currentEditId = null;
            showAlert('success', `–û–ø–ª–∞—Ç–∞ –Ω–∞ —Å—É–º–º—É ${formatCurrency(paymentAmount)} —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞!`);
            
            renderInvoicesTable();
            updateDashboard();
        }
        
        // –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—á–µ—Ç–∞
        function viewInvoice(id) {
            const invoice = AppState.invoices.find(inv => inv.id === id);
            if (!invoice) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>–°—á–µ—Ç –∑–∞ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                            th { background-color: #f2f2f2; }
                            @media print {
                                body { padding: 0; }
                                button { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        ${invoice.breakdown || '<p>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞</p>'}
                        <div style="margin-top: 30px; text-align: center;">
                            <button onclick="window.print()">–ü–µ—á–∞—Ç—å</button>
                            <button onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function renderActivitiesTable() {
            const tbody = document.getElementById('activitiesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            AppState.activityTypes.forEach(activity => {
                const row = document.createElement('tr');
                
                const finalCoefficient = activity.coefficient * (AppState.settings.dayTypeCoefficients[activity.dayType] || 1.0);
                const dayTypeBadge = getDayTypeBadge(activity.dayType);
                
                row.innerHTML = `
                    <td>${activity.id}</td>
                    <td><strong>${activity.name}</strong></td>
                    <td>${activity.coefficient}</td>
                    <td>${getDayTypeName(activity.dayType)}${dayTypeBadge}</td>
                    <td>${AppState.settings.dayTypeCoefficients[activity.dayType] || 1.0}</td>
                    <td><strong>${finalCoefficient.toFixed(2)}</strong></td>
                    <td style="font-size: 0.9rem;">${activity.description || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-primary" onclick="editActivity(${activity.id})">‚úèÔ∏è</button>
                        <button class="action-btn btn-danger" onclick="deleteActivity(${activity.id})">üóëÔ∏è</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function showAddActivityModal(activityId = null) {
            currentEditId = activityId;
            const isEditMode = activityId !== null;
            const activity = isEditMode ? AppState.activityTypes.find(a => a.id === activityId) : null;
            
            const title = document.getElementById('modalActivityTitle');
            if (title) {
                title.textContent = isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' : '–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏';
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('activityName').value = activity ? activity.name : '';
            document.getElementById('activityCoefficient').value = activity ? activity.coefficient : 1.0;
            document.getElementById('activityDayType').value = activity ? activity.dayType : 'normal';
            document.getElementById('activityDescription').value = activity ? activity.description || '' : '';
            
            openModal('activityModal');
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        async function saveActivity() {
            const isEditMode = currentEditId !== null;
            
            const name = document.getElementById('activityName').value.trim();
            const coefficientInput = document.getElementById('activityCoefficient');
            const coefficient = parseFloat(coefficientInput.value);
            
            if (!name || isNaN(coefficient) || coefficient < 0.5 || coefficient > 3.0) {
                showAlert('warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ—Ç 0.5 –¥–æ 3.0)');
                if (!name) {
                    document.getElementById('activityName').focus();
                } else if (isNaN(coefficient) || coefficient < 0.5 || coefficient > 3.0) {
                    coefficientInput.focus();
                }
                return;
            }
            
            if (isEditMode) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const activityIndex = AppState.activityTypes.findIndex(a => a.id === currentEditId);
                if (activityIndex === -1) return;
                
                AppState.activityTypes[activityIndex] = {
                    ...AppState.activityTypes[activityIndex],
                    name: name,
                    coefficient: coefficient,
                    dayType: document.getElementById('activityDayType').value,
                    description: document.getElementById('activityDescription').value.trim() || ''
                };
                
                showAlert('success', `–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ "${name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!`);
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const newActivity = {
                    id: AppState.activityTypes.length > 0 ? Math.max(...AppState.activityTypes.map(a => a.id)) + 1 : 1,
                    name: name,
                    coefficient: coefficient,
                    dayType: document.getElementById('activityDayType').value,
                    description: document.getElementById('activityDescription').value.trim() || ''
                };
                
                AppState.activityTypes.push(newActivity);
                showAlert('success', `–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            closeModal('activityModal');
            currentEditId = null;
            
            renderActivitiesTable();
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function editActivity(id) {
            showAddActivityModal(id);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        async function deleteActivity(id) {
            const activity = AppState.activityTypes.find(a => a.id === id);
            if (!activity) return;
            
            const usedByTenants = AppState.tenants.filter(t => t.activityTypeId === id);
            
            if (usedByTenants.length > 0 && !confirm(`–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ "${activity.name}" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ${usedByTenants.length} –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–º(–∞–º–∏). –£–¥–∞–ª–∏—Ç—å?`)) {
                return;
            }
            
            AppState.activityTypes = AppState.activityTypes.filter(a => a.id !== id);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', `–í–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ "${activity.name}" —É–¥–∞–ª–µ–Ω`);
            
            renderActivitiesTable();
        }
        
        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function renderSettings() {
            document.getElementById('coeffNormalDay').value = AppState.settings.dayTypeCoefficients.normal;
            document.getElementById('coeffExtendedDay').value = AppState.settings.dayTypeCoefficients.extended;
            document.getElementById('coeff24hDay').value = AppState.settings.dayTypeCoefficients['24h'];
            
            document.getElementById('mopArea').value = AppState.settings.mopArea;
            document.getElementById('mopCost').value = AppState.settings.mopCostPerSqm;
            document.getElementById('electricityLossPercent').value = AppState.settings.electricityLossPercent;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const versionElem = document.getElementById('appVersion');
            if (versionElem) {
                versionElem.textContent = `${AppState._meta.version} (—Å —É—á–µ—Ç–æ–º –≤–∏–¥–æ–≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)`;
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã
        async function saveDayTypeCoefficients() {
            AppState.settings.dayTypeCoefficients = {
                normal: parseFloat(document.getElementById('coeffNormalDay').value) || 1.0,
                extended: parseFloat(document.getElementById('coeffExtendedDay').value) || 1.3,
                '24h': parseFloat(document.getElementById('coeff24hDay').value) || 1.8
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            
            renderActivitiesTable();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ú–û–ü
        async function saveMopSettings() {
            AppState.settings.mopArea = parseFloat(document.getElementById('mopArea').value) || 150;
            AppState.settings.mopCostPerSqm = parseFloat(document.getElementById('mopCost').value) || 100;
            AppState.settings.electricityLossPercent = parseFloat(document.getElementById('electricityLossPercent').value) || 5;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ú–û–ü —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const dataStr = JSON.stringify(AppState, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `utility-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('success', `–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã: ${exportFileDefaultName}`);
        }
        
        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
                        if (importedData.tenants) AppState.tenants = importedData.tenants;
                        if (importedData.bills) AppState.bills = importedData.bills;
                        if (importedData.meterReadings) AppState.meterReadings = importedData.meterReadings;
                        if (importedData.invoices) AppState.invoices = importedData.invoices;
                        if (importedData.activityTypes) AppState.activityTypes = importedData.activityTypes;
                        if (importedData.settings) AppState.settings = importedData.settings;
                        if (importedData._meta) AppState._meta = { ...AppState._meta, ...importedData._meta };
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                        await saveData();
                        
                        showAlert('success', '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        
                        updateAllViews();
                    }
                } catch (error) {
                    showAlert('danger', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω.');
                }
                
                event.target.value = '';
            };
            reader.readAsText(file);
        }
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function confirmDeleteAllData() {
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                deleteAllData();
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        async function deleteAllData() {
            AppState.tenants = [];
            AppState.bills = [];
            AppState.meterReadings = {};
            AppState.invoices = [];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
            await saveData();
            
            showAlert('success', '–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã!');
            
            updateAllViews();
        }
        
        // ============================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.add('active');
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
            currentEditId = null;
        }
        
        function getDayTypeName(dayType) {
            const names = {
                'normal': '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å',
                'extended': '–ü—Ä–æ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å',
                '24h': '–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ'
            };
            return names[dayType] || dayType;
        }
        
        function getDayTypeBadge(dayType) {
            const badges = {
                'normal': '<span class="day-type-badge day-type-normal">8—á</span>',
                'extended': '<span class="day-type-badge day-type-extended">12-16—á</span>',
                '24h': '<span class="day-type-badge day-type-24h">24—á</span>'
            };
            return badges[dayType] || '';
        }
        
        function formatCurrency(amount) {
            if (isNaN(amount) || amount === null || amount === undefined) {
                return '0.00 —Ä—É–±.';
            }
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount) + ' —Ä—É–±.';
        }
        
        function formatCurrencyShort(amount) {
            if (isNaN(amount) || amount === null || amount === undefined) {
                return '0 ‚ÇΩ';
            }
            
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + ' –º–ª–Ω ‚ÇΩ';
            } else if (amount >= 1000) {
                return (amount / 1000).toFixed(1) + ' —Ç—ã—Å ‚ÇΩ';
            }
            
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount) + ' ‚ÇΩ';
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU');
            } catch (e) {
                return dateString;
            }
        }
        
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <strong>${type === 'success' ? '‚úì –£—Å–ø–µ—à–Ω–æ!' : type === 'warning' ? '‚ö† –í–Ω–∏–º–∞–Ω–∏–µ!' : type === 'info' ? '‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:' : '‚úó –û—à–∏–±–∫–∞!'}</strong>
                ${message}
                <button onclick="this.parentElement.remove()" style="position: absolute; right: 10px; top: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
            `;
            
            const container = document.querySelector('.container');
            if (container) {
                container.insertBefore(alertDiv, container.firstChild);
                
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.editTenant = editTenant;
        window.deleteTenant = deleteTenant;
        window.editBill = editBill;
        window.deleteBill = deleteBill;
        window.viewInvoice = viewInvoice;
        window.recordPayment = recordPayment;
        window.closeModal = closeModal;
        window.editActivity = editActivity;
        window.deleteActivity = deleteActivity;
        window.syncWithGitHub = syncWithGitHub;
        window.showGitHubInstructions = showGitHubInstructions;
    </script>
</body>
</html>